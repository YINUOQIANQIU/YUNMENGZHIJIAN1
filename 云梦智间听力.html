<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>å¬åŠ›ç»ƒä¹  - äº‘æ¢¦æ™ºé—´</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@400;500;600;700&display=swap" rel="stylesheet">
    
    <!-- ç»Ÿä¸€è®¤è¯ç³»ç»Ÿ -->
    <script src="äº‘æ¢¦æ™ºé—´ç»Ÿä¸€è®¤è¯.js"></script>
    <script src="äº‘æ¢¦æ™ºé—´UIç®¡ç†å™¨.js"></script>
    
    <style>
        body {
            font-family: 'Poppins', sans-serif;
            background: linear-gradient(135deg, #f5f7ff 0%, #e3f2ff 100%);
            min-height: 100vh;
        }
        .glass-effect {
            backdrop-filter: blur(8px);
            background-color: rgba(255, 255, 255, 0.95);
        }
        .progress-ring {
            transform: rotate(-90deg);
        }
        .progress-ring-circle {
            transition: stroke-dashoffset 0.5s ease;
        }
        .correct {
            border: 2px solid #10B981;
            box-shadow: 0 0 0 3px rgba(16, 185, 129, 0.1);
        }
        .incorrect {
            border: 2px solid #EF4444;
            box-shadow: 0 0 0 3px rgba(239, 68, 68, 0.1);
        }
        .fade-in {
            animation: fadeIn 0.5s ease-in;
        }
        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(10px); }
            to { opacity: 1; transform: translateY(0); }
        }
        .btn-primary {
            background: #2962FF;
            color: white;
            padding: 10px 20px;
            border-radius: 8px;
            border: none;
            cursor: pointer;
            transition: all 0.3s ease;
        }
        .btn-primary:hover {
            background: #1A237E;
            transform: translateY(-1px);
        }
        .btn-primary:disabled {
            background: #9CA3AF;
            cursor: not-allowed;
            transform: none;
        }
        .guest-overlay {
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: rgba(255, 255, 255, 0.9);
            display: flex;
            align-items: center;
            justify-content: center;
            border-radius: 12px;
            z-index: 10;
        }
        .login-required-card {
            text-align: center;
            padding: 2rem;
        }
        .login-required-card i {
            font-size: 3rem;
            color: #9CA3AF;
            margin-bottom: 1rem;
        }
        .login-required-card p {
            color: #6B7280;
            margin-bottom: 1.5rem;
        }
        
        /* å¬åŠ›ç»ƒä¹ ä¸“ç”¨æ ·å¼ */
        .paper-item {
            transition: all 0.3s ease;
            cursor: pointer;
        }
        .paper-item:hover {
            transform: translateY(-2px);
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.1);
        }
        .option-item {
            transition: all 0.2s ease;
        }
        .option-item:hover {
            background-color: #f8faff;
        }
        .option-item.selected {
            background-color: #dbeafe;
            border-color: #3b82f6;
        }
        #listening-audio {
            border-radius: 8px;
        }
        .audio-controls {
            display: flex;
            gap: 10px;
        }
        .audio-controls button {
            flex: 1;
            padding: 10px;
            border-radius: 6px;
            border: none;
            cursor: pointer;
            transition: all 0.2s;
            font-weight: 500;
        }
        .audio-controls button:hover {
            transform: translateY(-1px);
        }
        .progress-container {
            height: 6px;
            background-color: #e5e7eb;
            border-radius: 3px;
            margin-top: 10px;
            overflow: hidden;
        }
        .progress-bar {
            height: 100%;
            background-color: #3b82f6;
            width: 0%;
            transition: width 0.1s linear;
        }
        .question-navigation {
            display: flex;
            justify-content: center;
            gap: 10px;
            margin-top: 20px;
        }
        .question-nav-btn {
            width: 36px;
            height: 36px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            border: 1px solid #d1d5db;
            background: white;
            cursor: pointer;
            transition: all 0.2s;
        }
        .question-nav-btn:hover {
            background: #f3f4f6;
        }
        .question-nav-btn.active {
            background: #3b82f6;
            color: white;
            border-color: #3b82f6;
        }
        .question-nav-btn.answered {
            background: #10b981;
            color: white;
            border-color: #10b981;
        }
        .result-item {
            transition: all 0.2s;
        }
        .result-item:hover {
            transform: translateX(5px);
        }
        
        /* æ”¹è¿›çš„æŒ‰é’®æ ·å¼ */
        .start-practice-btn {
            background: linear-gradient(135deg, #4F46E5 0%, #7E22CE 100%);
            color: white;
            padding: 12px 24px;
            border-radius: 8px;
            border: none;
            font-weight: 600;
            box-shadow: 0 4px 6px rgba(79, 70, 229, 0.3);
            transition: all 0.3s ease;
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 8px;
        }
        .start-practice-btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 6px 12px rgba(79, 70, 229, 0.4);
        }
        .start-practice-btn:active {
            transform: translateY(0);
        }
        
        .start-paper-btn {
            background: linear-gradient(135deg, #3B82F6 0%, #1D4ED8 100%);
            color: white;
            padding: 8px 16px;
            border-radius: 6px;
            border: none;
            font-weight: 500;
            font-size: 0.875rem;
            box-shadow: 0 2px 4px rgba(59, 130, 246, 0.3);
            transition: all 0.2s ease;
        }
        .start-paper-btn:hover {
            transform: translateY(-1px);
            box-shadow: 0 4px 8px rgba(59, 130, 246, 0.4);
        }
        
        .action-btn {
            padding: 10px 20px;
            border-radius: 8px;
            border: none;
            font-weight: 500;
            transition: all 0.2s ease;
            cursor: pointer;
        }
        .action-btn.primary {
            background: #3B82F6;
            color: white;
        }
        .action-btn.primary:hover {
            background: #2563EB;
        }
        .action-btn.secondary {
            background: #6B7280;
            color: white;
        }
        .action-btn.secondary:hover {
            background: #4B5563;
        }
        .action-btn.success {
            background: #10B981;
            color: white;
        }
        .action-btn.success:hover {
            background: #059669;
        }
    </style>
</head>
<body>
    <!-- å¯¼èˆªæ  - å·²ä¿®æ”¹ä¸ºä¸é¦–é¡µå®Œå…¨ä¸€è‡´ -->
    <nav class="flex items-center justify-between px-6 lg:px-12 h-16 bg-white/90 backdrop-blur-md fixed top-0 left-0 right-0 z-50 border-b border-blue-50">
        <div class="flex items-center gap-8 lg:gap-16">
            <a href="äº‘æ¢¦æ™ºé—´é¦–é¡µ.html" class="flex items-center gap-3">
                <span class="text-2xl font-bold tracking-tight" style="color: #2962FF;">äº‘æ¢¦æ™ºé—´</span>
            </a>
            <div class="hidden lg:flex items-center gap-8">
                <a href="äº‘æ¢¦æ™ºé—´è®¡åˆ’.html" class="text-gray-700 hover:text-primary transition-colors font-medium">å¤‡è€ƒè§„åˆ’</a>
                <a href="äº‘æ¢¦æ™ºé—´æ•™å­¦.html" class="text-gray-700 hover:text-primary transition-colors font-medium">åœ¨çº¿æ•™å­¦</a>
                <a href="äº‘æ¢¦æ™ºé—´çœŸé¢˜è€ƒè¯•.html" class="text-gray-700 hover:text-primary transition-colors font-medium">çœŸé¢˜è€ƒè¯•</a>
                <a href="äº‘æ¢¦æ™ºé—´ç¤¾åŒº.html" class="text-gray-700 hover:text-primary transition-colors font-medium">å­¦ä¹ ç¤¾åŒº</a>
            </div>
        </div>
        
        <!-- åŠ¨æ€ç™»å½•/ç”¨æˆ·åŒºåŸŸ - å·²ä¿®æ”¹ä¸ºä¸é¦–é¡µå®Œå…¨ä¸€è‡´ -->
        <div class="flex items-center gap-4 lg:gap-6" id="auth-section">
            <div id="login-btn-container">
                <a href="äº‘æ¢¦æ™ºé—´ç™»å½•.html" class="flex items-center px-4 lg:px-6 py-2 bg-blue-50 text-primary rounded-button hover:bg-blue-100 transition-colors">
                    <span class="whitespace-nowrap font-medium text-sm lg:text-base">ç™»å½•</span>
                </a>
            </div>
            <a href="äº‘æ¢¦æ™ºé—´AIèŠå¤©.html" class="flex items-center px-4 lg:px-6 py-2 bg-primary text-white rounded-button hover:bg-secondary transition-colors">
                <span class="whitespace-nowrap font-medium text-sm lg:text-base">å…è´¹è¯•ç”¨</span>
            </a>
        </div>
    </nav>

    <!-- å…¨å±€å­¦ä¹ é€šçŸ¥ -->
    <div id="learning-global-notifications" class="fixed top-20 right-6 z-50 space-y-2"></div>

    <!-- ä¸»å†…å®¹åŒºåŸŸ -->
    <main class="pt-24 pb-16 max-w-[1440px] mx-auto px-6">
        <!-- å¬åŠ›ç»ƒä¹ å¤´éƒ¨ -->
        <div class="flex flex-col md:flex-row justify-between items-start md:items-center mb-8 fade-in">
            <div>
                <h1 class="text-2xl lg:text-3xl font-bold text-secondary mb-2">å¬åŠ›çœŸé¢˜ç»ƒä¹ </h1>
                <p class="text-gray-600">åŸºäºçœŸå®å››çº§å¬åŠ›çœŸé¢˜ï¼Œæå‡å¬åŠ›ç†è§£èƒ½åŠ›</p>
            </div>
            <div class="flex gap-3 mt-4 md:mt-0">
                <button id="start-listening-practice" class="start-practice-btn">
                    <i class="fas fa-play-circle"></i>
                    <span>å¼€å§‹ç»ƒä¹ </span>
                </button>
                <button id="show-stats" class="start-practice-btn" style="background: linear-gradient(135deg, #10B981 0%, #059669 100%);">
                    <i class="fas fa-chart-bar"></i>
                    <span>å­¦ä¹ ç»Ÿè®¡</span>
                </button>
            </div>
        </div>

        <!-- è¯•å·åˆ—è¡¨å®¹å™¨ -->
        <div id="papers-container">
            <div class="bg-white rounded-xl shadow-sm p-6 border border-blue-50 mb-6">
                <div class="flex items-center justify-between mb-6">
                    <h3 class="text-lg font-semibold text-secondary">å¬åŠ›çœŸé¢˜è¯•å·</h3>
                    <div id="audio-status" class="text-sm text-gray-500">
                        <i class="fas fa-info-circle mr-2"></i>
                        <span>å‡†å¤‡åŠ è½½è¯•å·</span>
                    </div>
                </div>
                <div id="papers-list" class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-4">
                    <!-- åŠ¨æ€åŠ è½½è¯•å·åˆ—è¡¨ -->
                    <div class="text-center py-8">
                        <i class="fas fa-spinner fa-spin text-2xl text-gray-300 mb-2"></i>
                        <p class="text-gray-500">åŠ è½½ä¸­...</p>
                    </div>
                </div>
            </div>
        </div>

        <!-- ç»ƒä¹ ç•Œé¢å®¹å™¨ -->
        <div id="practice-container" class="hidden">
            <div class="bg-white rounded-xl shadow-sm p-6 border border-blue-50 mb-6">
                <div class="flex items-center justify-between mb-6">
                    <h3 id="practice-title" class="text-lg font-semibold text-secondary">å¬åŠ›ç»ƒä¹ </h3>
                    <button id="back-to-list" class="action-btn secondary">
                        <i class="fas fa-arrow-left mr-2"></i>
                        <span>è¿”å›åˆ—è¡¨</span>
                    </button>
                </div>
                
                <!-- éŸ³é¢‘æ’­æ”¾å™¨ -->
                <div id="audio-player-container" class="mb-6">
                    <!-- åŠ¨æ€åŠ è½½éŸ³é¢‘æ’­æ”¾å™¨ -->
                </div>
                
                <!-- é¢˜ç›®å¯¼èˆª -->
                <div id="question-navigation" class="mb-6">
                    <!-- åŠ¨æ€åŠ è½½é¢˜ç›®å¯¼èˆª -->
                </div>
                
                <!-- é¢˜ç›®å®¹å™¨ -->
                <div id="question-container">
                    <!-- åŠ¨æ€åŠ è½½é¢˜ç›® -->
                </div>
            </div>
        </div>

        <!-- ç»“æœç•Œé¢å®¹å™¨ -->
        <div id="results-container" class="hidden">
            <div class="bg-white rounded-xl shadow-sm p-6 border border-blue-50">
                <div id="results-content">
                    <!-- åŠ¨æ€åŠ è½½ç»“æœ -->
                </div>
            </div>
        </div>

        <!-- æ¸¸å®¢æ¨¡å¼é®ç½© -->
        <div id="listening-guest-overlay" class="guest-overlay hidden">
            <div class="text-center p-8">
                <i class="fas fa-lock text-4xl text-gray-400 mb-4"></i>
                <h3 class="text-xl font-semibold text-gray-700 mb-2">å¬åŠ›ç»ƒä¹ </h3>
                <p class="text-gray-500 mb-6">è¯·ç™»å½•åä½¿ç”¨å¬åŠ›çœŸé¢˜ç»ƒä¹ åŠŸèƒ½</p>
                <button onclick="listeningManager.handleLogin()" class="btn-primary">
                    <i class="fas fa-sign-in-alt mr-2"></i>ç«‹å³ç™»å½•
                </button>
            </div>
        </div>
    </main>

    <!-- å­¦ä¹ ç»Ÿè®¡æ¨¡æ€æ¡† -->
    <div id="stats-modal" class="fixed inset-0 z-50 hidden">
        <div class="absolute inset-0 bg-black/50 backdrop-blur-sm" id="stats-overlay"></div>
        <div class="flex items-center justify-center min-h-screen p-4">
            <div class="bg-white rounded-xl shadow-xl max-w-4xl w-full mx-auto max-h-[80vh] overflow-y-auto transform transition-all fade-in">
                <div class="flex justify-between items-center p-6 border-b border-gray-200 bg-gradient-to-r from-primary to-secondary">
                    <h3 class="text-lg font-semibold text-white">å¬åŠ›å­¦ä¹ ç»Ÿè®¡</h3>
                    <button id="close-stats-modal" class="text-white hover:text-gray-200 transition-colors">
                        <i class="fas fa-times text-xl"></i>
                    </button>
                </div>
                <div class="p-6">
                    <div id="stats-content">
                        <!-- åŠ¨æ€åŠ è½½ç»Ÿè®¡å†…å®¹ -->
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- æ¶ˆæ¯æç¤º -->
    <div id="message-toast" class="fixed top-4 right-4 z-50 hidden">
        <div class="bg-white rounded-lg shadow-lg border-l-4 p-4 min-w-80 transform transition-all fade-in">
            <div class="flex items-center">
                <i class="fas fa-info-circle text-primary text-xl mr-3" id="message-icon"></i>
                <div class="flex-1">
                    <p class="font-medium text-gray-800" id="message-text"></p>
                </div>
                <button onclick="hideMessage()" class="text-gray-400 hover:text-gray-600 ml-4">
                    <i class="fas fa-times"></i>
                </button>
            </div>
        </div>
    </div>

    <script>
        // å¬åŠ›ç»ƒä¹ ç®¡ç†å™¨
        class ListeningPracticeManager {
            constructor() {
                this.currentPaper = null;
                this.currentQuestions = [];
                this.currentQuestionIndex = 0;
                this.userAnswers = {};
                this.audioPlayer = null;
                this.isPlaying = false;
                this.isAuthenticated = false;
                this.currentUser = null;
                this.audioProgressInterval = null;
                this.audioProgressBar = null;
                
                this.init();
            }

            async init() {
                console.log('ğŸ§ åˆå§‹åŒ–å¬åŠ›ç»ƒä¹ ç®¡ç†å™¨');
                this.bindEvents();
                await this.checkAuthentication();
                this.updateAuthUI();
                
                if (this.isAuthenticated) {
                    await this.loadListeningPapers();
                }
            }

            // æ£€æŸ¥è®¤è¯çŠ¶æ€
            async checkAuthentication() {
                try {
                    // ä½¿ç”¨ç»Ÿä¸€è®¤è¯ç³»ç»Ÿæ£€æŸ¥çŠ¶æ€
                    if (window.unifiedAuthManager) {
                        this.isAuthenticated = window.unifiedAuthManager.isLoggedIn();
                        this.currentUser = window.unifiedAuthManager.getCurrentUser();
                    } else if (window.uiManager && window.uiManager.authManager) {
                        this.isAuthenticated = window.uiManager.authManager.isLoggedIn();
                        this.currentUser = window.uiManager.authManager.getCurrentUser();
                    } else {
                        // é™çº§ï¼šæ£€æŸ¥æœ¬åœ°å­˜å‚¨
                        const token = localStorage.getItem('auth_token');
                        const userData = localStorage.getItem('user_data');
                        this.isAuthenticated = !!(token && userData);
                        if (userData) {
                            try {
                                this.currentUser = JSON.parse(userData);
                            } catch (e) {
                                console.error('è§£æç”¨æˆ·æ•°æ®å¤±è´¥:', e);
                            }
                        }
                    }
                } catch (error) {
                    console.error('è®¤è¯æ£€æŸ¥å¤±è´¥:', error);
                }
            }

            // æ›´æ–°è®¤è¯UI
            updateAuthUI() {
                if (this.isAuthenticated && this.currentUser) {
                    this.showAuthenticatedUI();
                } else {
                    this.showLoginRequired();
                }
            }

            // æ˜¾ç¤ºå·²ç™»å½•UI
            showAuthenticatedUI() {
                console.log('âœ… æ˜¾ç¤ºå·²ç™»å½•çŠ¶æ€UI - å¬åŠ›');
                this.enableAllFeatures();
                this.hideGuestOverlays();
            }

            // æ˜¾ç¤ºç™»å½•è¦æ±‚
            showLoginRequired() {
                console.log('ğŸ” æ˜¾ç¤ºç™»å½•è¦æ±‚ - å¬åŠ›');
                this.disableAllFeatures();
                this.showGuestOverlays();
                this.showLoginRequiredContent();
            }

            // å¯ç”¨åŠŸèƒ½
            enableAllFeatures() {
                const practiceButtons = document.querySelectorAll('#start-listening-practice, #show-stats');
                practiceButtons.forEach(btn => {
                    if (btn) {
                        btn.disabled = false;
                        btn.classList.remove('opacity-50', 'cursor-not-allowed');
                    }
                });
            }

            // ç¦ç”¨åŠŸèƒ½
            disableAllFeatures() {
                const practiceButtons = document.querySelectorAll('#start-listening-practice, #show-stats');
                practiceButtons.forEach(btn => {
                    if (btn) {
                        btn.disabled = true;
                        btn.classList.add('opacity-50', 'cursor-not-allowed');
                    }
                });
            }

            // éšè—æ¸¸å®¢é®ç½©
            hideGuestOverlays() {
                const overlay = document.getElementById('listening-guest-overlay');
                if (overlay) {
                    overlay.classList.add('hidden');
                }
            }

            // æ˜¾ç¤ºæ¸¸å®¢é®ç½©
            showGuestOverlays() {
                const overlay = document.getElementById('listening-guest-overlay');
                if (overlay) {
                    overlay.classList.remove('hidden');
                }
            }

            // æ˜¾ç¤ºç™»å½•è¦æ±‚å†…å®¹
            showLoginRequiredContent() {
                const containers = ['papers-list', 'practice-container', 'results-container'];
                containers.forEach(containerId => {
                    const container = document.getElementById(containerId);
                    if (container) {
                        container.innerHTML = this.getLoginRequiredCardHTML('å¬åŠ›ç»ƒä¹ ');
                    }
                });
            }

            // è·å–ç™»å½•è¦æ±‚å¡ç‰‡HTML
            getLoginRequiredCardHTML(title) {
                return `
                    <div class="login-required-card text-center py-8">
                        <i class="fas fa-user-lock text-4xl text-gray-400 mb-4"></i>
                        <h3 class="text-lg font-semibold text-gray-700 mb-2">${title}</h3>
                        <p class="text-gray-500 mb-4">è¯·ç™»å½•åä½¿ç”¨å¬åŠ›ç»ƒä¹ åŠŸèƒ½</p>
                        <button onclick="listeningManager.handleLogin()" class="btn-primary">
                            <i class="fas fa-sign-in-alt mr-2"></i>ç«‹å³ç™»å½•
                        </button>
                    </div>
                `;
            }

            // å¤„ç†ç™»å½•
            handleLogin() {
                window.location.href = 'äº‘æ¢¦æ™ºé—´ç™»å½•.html';
            }

            // ç»‘å®šäº‹ä»¶
            bindEvents() {
                // å¼€å§‹ç»ƒä¹ æŒ‰é’®
                const startPracticeBtn = document.getElementById('start-listening-practice');
                if (startPracticeBtn) {
                    startPracticeBtn.addEventListener('click', () => {
                        if (!this.isAuthenticated) {
                            this.showLoginRequired();
                            return;
                        }
                        this.startPractice();
                    });
                }

                // æ˜¾ç¤ºç»Ÿè®¡æŒ‰é’®
                const showStatsBtn = document.getElementById('show-stats');
                if (showStatsBtn) {
                    showStatsBtn.addEventListener('click', () => {
                        if (!this.isAuthenticated) {
                            this.showLoginRequired();
                            return;
                        }
                        this.showStats();
                    });
                }

                // è¿”å›åˆ—è¡¨æŒ‰é’®
                const backToListBtn = document.getElementById('back-to-list');
                if (backToListBtn) {
                    backToListBtn.addEventListener('click', () => {
                        this.showPapersList();
                    });
                }

                // å…³é—­ç»Ÿè®¡æ¨¡æ€æ¡†
                const closeStatsBtn = document.getElementById('close-stats-modal');
                const statsOverlay = document.getElementById('stats-overlay');
                if (closeStatsBtn) {
                    closeStatsBtn.addEventListener('click', () => {
                        this.hideStatsModal();
                    });
                }
                if (statsOverlay) {
                    statsOverlay.addEventListener('click', () => {
                        this.hideStatsModal();
                    });
                }

                // è®¾ç½®è®¤è¯ç›‘å¬å™¨
                this.setupAuthListeners();
            }

            // è®¾ç½®è®¤è¯ç›‘å¬å™¨
            setupAuthListeners() {
                if (window.unifiedAuthManager) {
                    window.unifiedAuthManager.addAuthListener((isLoggedIn, user) => {
                        this.isAuthenticated = isLoggedIn;
                        this.currentUser = user;
                        this.updateAuthUI();
                        
                        if (isLoggedIn) {
                            this.loadListeningPapers();
                        }
                    });
                }
                
                if (window.uiManager && window.uiManager.authManager) {
                    window.uiManager.authManager.addAuthListener((isLoggedIn, user) => {
                        this.isAuthenticated = isLoggedIn;
                        this.currentUser = user;
                        this.updateAuthUI();
                        
                        if (isLoggedIn) {
                            this.loadListeningPapers();
                        }
                    });
                }
            }

            // åŠ è½½å¬åŠ›è¯•å·åˆ—è¡¨ - ä¿®å¤ç‰ˆ
            async loadListeningPapers() {
                try {
                    const response = await fetch('/api/listening/papers', {
                        headers: window.unifiedAuthManager.getAuthHeaders()
                    });
                    const result = await response.json();
                    
                    if (result.success) {
                        this.renderPapersList(result.data);
                    } else {
                        this.showMessage('åŠ è½½è¯•å·åˆ—è¡¨å¤±è´¥', 'error');
                    }
                } catch (error) {
                    console.error('åŠ è½½å¬åŠ›è¯•å·å¤±è´¥:', error);
                    this.showMessage('ç½‘ç»œé”™è¯¯ï¼Œè¯·é‡è¯•', 'error');
                }
            }

            // æ¸²æŸ“è¯•å·åˆ—è¡¨ - ä¿®å¤å­—æ®µæ˜ å°„
            renderPapersList(papers) {
                const container = document.getElementById('papers-list');
                if (!container) return;

                if (papers.length === 0) {
                    container.innerHTML = `
                        <div class="text-center py-8 col-span-3">
                            <i class="fas fa-headphones text-4xl text-gray-300 mb-4"></i>
                            <p class="text-gray-500">æš‚æ— å¬åŠ›çœŸé¢˜</p>
                        </div>
                    `;
                    return;
                }

                container.innerHTML = papers.map(paper => `
                    <div class="bg-white rounded-lg border border-gray-200 p-4 hover:shadow-md transition-shadow cursor-pointer paper-item" data-paper-id="${paper.id}">
                        <div class="flex justify-between items-start mb-2">
                            <div>
                                <h4 class="font-semibold text-gray-800">${paper.title}</h4>
                                <p class="text-sm text-gray-600">${paper.year}å¹´${paper.month}æœˆ â€¢ ${paper.listening_questions_count || 0} é¢˜</p>
                            </div>
                            <div class="flex flex-col items-end">
                                <span class="px-2 py-1 bg-blue-100 text-blue-600 text-xs rounded-full mb-1">${paper.exam_type}</span>
                                <span class="px-2 py-1 ${paper.has_audio ? 'bg-green-100 text-green-600' : 'bg-yellow-100 text-yellow-600'} text-xs rounded-full">
                                    ${paper.has_audio ? 'æœ‰éŸ³é¢‘' : 'æ— éŸ³é¢‘'}
                                </span>
                            </div>
                        </div>
                        <div class="flex justify-between items-center text-sm text-gray-500">
                            <span class="flex items-center">
                                <i class="fas ${paper.has_audio ? 'fa-volume-up text-green-500' : 'fa-volume-mute text-yellow-500'} mr-1"></i>
                                ${paper.audio_file || 'éŸ³é¢‘æ–‡ä»¶'}
                            </span>
                            <button class="start-paper-btn">
                                å¼€å§‹ç»ƒä¹ 
                            </button>
                        </div>
                    </div>
                `).join('');

                // ç»‘å®šè¯•å·ç‚¹å‡»äº‹ä»¶
                document.querySelectorAll('.paper-item').forEach(item => {
                    const paperId = item.dataset.paperId;
                    const startBtn = item.querySelector('.start-paper-btn');
                    
                    if (startBtn) {
                        startBtn.addEventListener('click', (e) => {
                            e.stopPropagation();
                            this.startPaperPractice(paperId);
                        });
                    }
                    
                    item.addEventListener('click', () => {
                        this.startPaperPractice(paperId);
                    });
                });
            }

            // å¼€å§‹è¯•å·ç»ƒä¹  - ä¿®å¤ç‰ˆ
            async startPaperPractice(paperId) {
                try {
                    const response = await fetch(`/api/listening/papers/${paperId}`, {
                        headers: window.unifiedAuthManager.getAuthHeaders()
                    });
                    const result = await response.json();
                    
                    if (result.success) {
                        this.currentPaper = result.data.paper;
                        this.currentQuestions = result.data.questions;
                        this.currentQuestionIndex = 0;
                        this.userAnswers = {};
                        
                        this.showPracticeInterface();
                        this.loadCurrentQuestion();
                        
                        // è‡ªåŠ¨å¤„ç†éŸ³é¢‘æ–‡ä»¶
                        await this.handleAudioSetup();
                    } else {
                        this.showMessage('åŠ è½½è¯•å·å¤±è´¥', 'error');
                    }
                } catch (error) {
                    console.error('å¼€å§‹ç»ƒä¹ å¤±è´¥:', error);
                    this.showMessage('ç½‘ç»œé”™è¯¯ï¼Œè¯·é‡è¯•', 'error');
                }
            }

            // è‡ªåŠ¨å¤„ç†éŸ³é¢‘æ–‡ä»¶
            async autoProcessAudio(paper) {
                try {
                    // å¦‚æœè¯•å·å·²ç»æœ‰éŸ³é¢‘ä¿¡æ¯ï¼Œç›´æ¥ä½¿ç”¨
                    if (paper.audio_url && paper.has_audio) {
                        console.log('âœ… ä½¿ç”¨å·²æœ‰çš„éŸ³é¢‘æ–‡ä»¶:', paper.audio_url);
                        return paper.audio_url;
                    }
                    
                    // å¦åˆ™å°è¯•é‡æ–°æŸ¥æ‰¾éŸ³é¢‘
                    const response = await fetch(`/api/listening/check-audio-file?filename=${encodeURIComponent(paper.audio_file)}`, {
                        headers: window.unifiedAuthManager.getAuthHeaders()
                    });
                    const result = await response.json();
                    
                    if (result.exists) {
                        console.log('ğŸ” æ‰¾åˆ°éŸ³é¢‘æ–‡ä»¶:', result.web_url);
                        return result.web_url;
                    } else {
                        console.log('âŒ éŸ³é¢‘æ–‡ä»¶æœªæ‰¾åˆ°:', paper.audio_file);
                        return null;
                    }
                } catch (error) {
                    console.error('éŸ³é¢‘å¤„ç†å¤±è´¥:', error);
                    return null;
                }
            }

            // å¤„ç†éŸ³é¢‘è®¾ç½®
            async handleAudioSetup() {
                if (!this.currentPaper) return;
                
                const audioStatus = document.getElementById('audio-status');
                if (!audioStatus) return;
                
                // è‡ªåŠ¨å¤„ç†éŸ³é¢‘æ–‡ä»¶
                const audioUrl = await this.autoProcessAudio(this.currentPaper);
                
                if (audioUrl) {
                    audioStatus.innerHTML = `
                        <i class="fas fa-check-circle text-green-500 mr-2"></i>
                        <span>éŸ³é¢‘æ–‡ä»¶å¯ç”¨</span>
                    `;
                    this.setupAudioPlayer(audioUrl);
                } else {
                    audioStatus.innerHTML = `
                        <i class="fas fa-exclamation-triangle text-yellow-500 mr-2"></i>
                        <span>éŸ³é¢‘æ–‡ä»¶æœªæ‰¾åˆ°: ${this.currentPaper.audio_file}</span>
                    `;
                    this.showAudioHelpInfo();
                }
            }

            // æ˜¾ç¤ºéŸ³é¢‘å¸®åŠ©ä¿¡æ¯
            showAudioHelpInfo() {
                const audioContainer = document.getElementById('audio-player-container');
                if (!audioContainer) return;
                
                audioContainer.innerHTML += `
                    <div class="mt-4 p-4 bg-yellow-50 border border-yellow-200 rounded-lg">
                        <div class="flex items-start">
                            <i class="fas fa-info-circle text-yellow-500 mt-1 mr-3"></i>
                            <div>
                                <h5 class="font-semibold text-yellow-700 mb-2">éŸ³é¢‘æ–‡ä»¶æœªæ‰¾åˆ°</h5>
                                <p class="text-yellow-600 text-sm mb-2">
                                    ç³»ç»Ÿæ­£åœ¨æŸ¥æ‰¾æ–‡ä»¶: <code class="bg-yellow-100 px-1 rounded">${this.currentPaper.audio_file}</code>
                                </p>
                                <p class="text-yellow-600 text-sm">
                                    è¯·ç¡®ä¿éŸ³é¢‘æ–‡ä»¶å·²æ”¾ç½®åœ¨ <code class="bg-yellow-100 px-1 rounded">çœŸé¢˜ä¸å¬åŠ›/å››çº§å¬åŠ›/</code> ç›®å½•ä¸­
                                </p>
                                <div class="mt-2">
                                    <button onclick="listeningManager.rescanAudio()" class="text-xs bg-yellow-500 text-white px-3 py-1 rounded hover:bg-yellow-600 transition-colors">
                                        é‡æ–°æ‰«æéŸ³é¢‘
                                    </button>
                                </div>
                            </div>
                        </div>
                    </div>
                `;
            }

            // é‡æ–°æ‰«æéŸ³é¢‘
            async rescanAudio() {
                try {
                    this.showMessage('æ­£åœ¨é‡æ–°æ‰«æéŸ³é¢‘æ–‡ä»¶...', 'info');
                    
                    const response = await fetch('/api/listening/rescan-audio', {
                        method: 'POST',
                        headers: window.unifiedAuthManager.getAuthHeaders()
                    });
                    const result = await response.json();
                    
                    if (result.success) {
                        this.showMessage(`æ‰«æå®Œæˆ: ${result.data.matched_papers}/${result.data.total_papers} å¥—è¯•å·åŒ¹é…æˆåŠŸ`, 'success');
                        // é‡æ–°åŠ è½½è¯•å·åˆ—è¡¨
                        await this.loadListeningPapers();
                    } else {
                        this.showMessage('é‡æ–°æ‰«æå¤±è´¥', 'error');
                    }
                } catch (error) {
                    console.error('é‡æ–°æ‰«æéŸ³é¢‘å¤±è´¥:', error);
                    this.showMessage('é‡æ–°æ‰«æå¤±è´¥', 'error');
                }
            }

            // è®¾ç½®éŸ³é¢‘æ’­æ”¾å™¨ - ä½¿ç”¨æ–°çš„APIç«¯ç‚¹
            setupAudioPlayer(audioUrl) {
                // ä½¿ç”¨æ–°çš„APIç«¯ç‚¹
                const actualAudioUrl = `/api/listening/audio/${this.currentPaper.audio_file}`;
                
                const audioContainer = document.getElementById('audio-player-container');
                if (!audioContainer) return;

                audioContainer.innerHTML = `
                    <div class="bg-white rounded-lg p-4 border border-gray-200">
                        <div class="flex items-center justify-between mb-3">
                            <h4 class="font-semibold text-gray-800">å¬åŠ›éŸ³é¢‘</h4>
                            <span class="text-sm text-gray-500">${this.currentPaper.audio_file}</span>
                        </div>
                        <audio id="listening-audio" controls class="w-full">
                            <source src="${actualAudioUrl}" type="audio/mpeg">
                            æ‚¨çš„æµè§ˆå™¨ä¸æ”¯æŒéŸ³é¢‘æ’­æ”¾ã€‚
                        </audio>
                        <div class="progress-container mt-2">
                            <div class="progress-bar" id="audio-progress"></div>
                        </div>
                        <div class="audio-controls mt-3">
                            <button id="play-audio" class="bg-primary text-white">
                                <i class="fas fa-play mr-2"></i>æ’­æ”¾
                            </button>
                            <button id="pause-audio" class="bg-gray-500 text-white">
                                <i class="fas fa-pause mr-2"></i>æš‚åœ
                            </button>
                            <button id="replay-audio" class="bg-blue-500 text-white">
                                <i class="fas fa-redo mr-2"></i>é‡æ’­
                            </button>
                        </div>
                    </div>
                `;

                this.audioPlayer = document.getElementById('listening-audio');
                this.audioProgressBar = document.getElementById('audio-progress');
                
                if (!this.audioPlayer) {
                    console.error('éŸ³é¢‘æ’­æ”¾å™¨å…ƒç´ æœªæ‰¾åˆ°');
                    return;
                }
                
                // æ›´æ–°è¿›åº¦æ¡
                this.audioPlayer.addEventListener('timeupdate', () => {
                    if (this.audioPlayer.duration) {
                        const percent = (this.audioPlayer.currentTime / this.audioPlayer.duration) * 100;
                        if (this.audioProgressBar) {
                            this.audioProgressBar.style.width = percent + '%';
                        }
                    }
                });
                
                // ç»‘å®šéŸ³é¢‘æ§åˆ¶äº‹ä»¶
                const playBtn = document.getElementById('play-audio');
                const pauseBtn = document.getElementById('pause-audio');
                const replayBtn = document.getElementById('replay-audio');
                
                if (playBtn) {
                    playBtn.addEventListener('click', () => {
                        this.audioPlayer.play();
                        this.isPlaying = true;
                    });
                }
                
                if (pauseBtn) {
                    pauseBtn.addEventListener('click', () => {
                        this.audioPlayer.pause();
                        this.isPlaying = false;
                    });
                }
                
                if (replayBtn) {
                    replayBtn.addEventListener('click', () => {
                        this.audioPlayer.currentTime = 0;
                        this.audioPlayer.play();
                        this.isPlaying = true;
                    });
                }

                // éŸ³é¢‘ç»“æŸäº‹ä»¶
                this.audioPlayer.addEventListener('ended', () => {
                    this.isPlaying = false;
                });
                
                console.log('âœ… éŸ³é¢‘æ’­æ”¾å™¨è®¾ç½®å®Œæˆ');
            }

            // æ˜¾ç¤ºç»ƒä¹ ç•Œé¢
            showPracticeInterface() {
                document.getElementById('papers-container').classList.add('hidden');
                document.getElementById('practice-container').classList.remove('hidden');
                
                // æ›´æ–°ç»ƒä¹ æ ‡é¢˜
                const practiceTitle = document.getElementById('practice-title');
                if (practiceTitle && this.currentPaper) {
                    practiceTitle.textContent = `å¬åŠ›ç»ƒä¹  - ${this.currentPaper.title}`;
                }
            }

            // æ˜¾ç¤ºè¯•å·åˆ—è¡¨
            showPapersList() {
                document.getElementById('practice-container').classList.add('hidden');
                document.getElementById('results-container').classList.add('hidden');
                document.getElementById('papers-container').classList.remove('hidden');
                
                // åœæ­¢éŸ³é¢‘æ’­æ”¾
                if (this.audioPlayer) {
                    this.audioPlayer.pause();
                    this.isPlaying = false;
                }
            }

            // åŠ è½½å½“å‰é¢˜ç›® - ä¿®å¤ç‰ˆ
            loadCurrentQuestion() {
                if (this.currentQuestions.length === 0) return;
                
                const question = this.currentQuestions[this.currentQuestionIndex];
                const container = document.getElementById('question-container');
                const navigationContainer = document.getElementById('question-navigation');
                
                if (!container) return;

                // æ›´æ–°é¢˜ç›®å¯¼èˆª
                if (navigationContainer) {
                    navigationContainer.innerHTML = `
                        <div class="flex flex-wrap gap-2 justify-center">
                            ${this.currentQuestions.map((_, index) => `
                                <button class="question-nav-btn ${index === this.currentQuestionIndex ? 'active' : ''} ${this.userAnswers[index] ? 'answered' : ''}" data-index="${index}">
                                    ${index + 1}
                                </button>
                            `).join('')}
                        </div>
                    `;
                    
                    // ç»‘å®šå¯¼èˆªæŒ‰é’®äº‹ä»¶
                    navigationContainer.querySelectorAll('.question-nav-btn').forEach(btn => {
                        btn.addEventListener('click', () => {
                            const index = parseInt(btn.dataset.index);
                            this.currentQuestionIndex = index;
                            this.loadCurrentQuestion();
                        });
                    });
                }

                // ç¡®ä¿é€‰é¡¹æ˜¯æ•°ç»„æ ¼å¼
                let options = [];
                if (question.options && Array.isArray(question.options)) {
                    options = question.options;
                } else if (typeof question.options === 'string') {
                    try {
                        options = JSON.parse(question.options);
                    } catch (e) {
                        console.warn('é€‰é¡¹è§£æå¤±è´¥ï¼Œå°è¯•å¤‡ç”¨è§£æ:', e);
                        if (question.options.includes(',')) {
                            options = question.options.split(',').map(opt => opt.trim());
                        } else {
                            options = [question.options];
                        }
                    }
                }
                
                container.innerHTML = `
                    <div class="bg-white rounded-lg border border-gray-200 p-6">
                        <div class="flex justify-between items-center mb-4">
                            <h4 class="font-semibold text-gray-800">é¢˜ç›® ${this.currentQuestionIndex + 1}/${this.currentQuestions.length}</h4>
                            <span class="px-2 py-1 bg-gray-100 text-gray-600 text-sm rounded">${question.section_type || 'å¬åŠ›'}</span>
                        </div>
                        
                        <div class="mb-4 p-3 bg-gray-50 rounded">
                            <p class="text-gray-700">${question.question_text || 'é¢˜ç›®å†…å®¹'}</p>
                        </div>
                        
                        <div class="space-y-2 mb-6">
                            ${options.length > 0 ? options.map((option, index) => {
                                const optionLetter = String.fromCharCode(65 + index); // A, B, C, D
                                const isSelected = this.userAnswers[this.currentQuestionIndex] === optionLetter;
                                return `
                                    <label class="flex items-center p-3 border border-gray-200 rounded hover:bg-gray-50 cursor-pointer option-item ${isSelected ? 'selected' : ''}">
                                        <input type="radio" name="answer" value="${optionLetter}" class="mr-3" ${isSelected ? 'checked' : ''}>
                                        <span class="flex-1">${option}</span>
                                    </label>
                                `;
                            }).join('') : '<p class="text-gray-500">æš‚æ— é€‰é¡¹</p>'}
                        </div>
                        
                        <div class="flex justify-between items-center">
                            <div class="text-sm text-gray-500">
                                å·²é€‰æ‹©: <span id="selected-answer">${this.userAnswers[this.currentQuestionIndex] || 'æœªé€‰æ‹©'}</span>
                            </div>
                            <div class="flex gap-2">
                                ${this.currentQuestionIndex > 0 ? `
                                    <button id="prev-question" class="action-btn secondary">
                                        ä¸Šä¸€é¢˜
                                    </button>
                                ` : ''}
                                ${this.currentQuestionIndex < this.currentQuestions.length - 1 ? `
                                    <button id="next-question" class="action-btn primary">
                                        ä¸‹ä¸€é¢˜
                                    </button>
                                ` : `
                                    <button id="submit-practice" class="action-btn success">
                                        æäº¤ç­”æ¡ˆ
                                    </button>
                                `}
                            </div>
                        </div>
                    </div>
                `;

                // ç»‘å®šé€‰é¡¹é€‰æ‹©äº‹ä»¶
                document.querySelectorAll('.option-item').forEach(item => {
                    item.addEventListener('click', () => {
                        document.querySelectorAll('.option-item').forEach(opt => {
                            opt.classList.remove('selected');
                        });
                        item.classList.add('selected');
                        
                        const selectedValue = item.querySelector('input').value;
                        document.getElementById('selected-answer').textContent = selectedValue;
                        this.userAnswers[this.currentQuestionIndex] = selectedValue;
                        
                        // æ›´æ–°å¯¼èˆªæŒ‰é’®çŠ¶æ€
                        const navBtn = document.querySelector(`.question-nav-btn[data-index="${this.currentQuestionIndex}"]`);
                        if (navBtn) {
                            navBtn.classList.add('answered');
                        }
                    });
                });

                // ç»‘å®šå¯¼èˆªæŒ‰é’®äº‹ä»¶
                if (this.currentQuestionIndex > 0) {
                    document.getElementById('prev-question').addEventListener('click', () => {
                        this.currentQuestionIndex--;
                        this.loadCurrentQuestion();
                    });
                }

                if (this.currentQuestionIndex < this.currentQuestions.length - 1) {
                    document.getElementById('next-question').addEventListener('click', () => {
                        this.currentQuestionIndex++;
                        this.loadCurrentQuestion();
                    });
                } else {
                    document.getElementById('submit-practice').addEventListener('click', () => {
                        this.submitPractice();
                    });
                }
            }

            // æäº¤ç»ƒä¹ 
            submitPractice() {
                const totalQuestions = this.currentQuestions.length;
                const answeredQuestions = Object.keys(this.userAnswers).length;
                
                if (answeredQuestions < totalQuestions) {
                    if (!confirm(`æ‚¨è¿˜æœ‰ ${totalQuestions - answeredQuestions} é¢˜æœªä½œç­”ï¼Œç¡®å®šè¦æäº¤å—ï¼Ÿ`)) {
                        return;
                    }
                }

                this.calculateResults();
            }

            // è®¡ç®—ç»“æœ
            calculateResults() {
                let correctCount = 0;
                const results = [];

                this.currentQuestions.forEach((question, index) => {
                    const userAnswer = this.userAnswers[index];
                    const isCorrect = userAnswer === question.correct_answer;
                    
                    if (isCorrect) correctCount++;
                    
                    results.push({
                        question: question.question_text || `é¢˜ç›® ${index + 1}`,
                        userAnswer: userAnswer || 'æœªä½œç­”',
                        correctAnswer: question.correct_answer || 'æœªçŸ¥',
                        isCorrect: isCorrect,
                        options: question.options || [],
                        explanation: question.explanation || 'æš‚æ— è§£æ'
                    });
                });

                const score = Math.round((correctCount / this.currentQuestions.length) * 100);
                
                this.showResults(score, correctCount, results);
            }

            // æ˜¾ç¤ºç»“æœ
            showResults(score, correctCount, results) {
                document.getElementById('practice-container').classList.add('hidden');
                document.getElementById('results-container').classList.remove('hidden');
                
                const resultsContainer = document.getElementById('results-content');
                if (!resultsContainer) return;

                resultsContainer.innerHTML = `
                    <div class="bg-white rounded-lg border border-gray-200 p-6">
                        <div class="text-center mb-6">
                            <div class="w-24 h-24 mx-auto mb-4 relative">
                                <svg class="w-full h-full" viewBox="0 0 36 36">
                                    <circle cx="18" cy="18" r="16" fill="none" stroke="#E0E0E0" stroke-width="2"/>
                                    <circle cx="18" cy="18" r="16" fill="none" stroke="#4F46E5" stroke-width="2" 
                                            stroke-dasharray="100" stroke-dashoffset="${100 - score}" 
                                            stroke-linecap="round" transform="rotate(-90 18 18)"/>
                                </svg>
                                <span class="absolute inset-0 flex items-center justify-center font-bold text-2xl text-primary">
                                    ${score}%
                                </span>
                            </div>
                            <h3 class="text-xl font-bold text-gray-800 mb-2">ç»ƒä¹ å®Œæˆ</h3>
                            <p class="text-gray-600">æ­£ç¡®: ${correctCount}/${this.currentQuestions.length} é¢˜</p>
                        </div>
                        
                        <div class="space-y-4 max-h-96 overflow-y-auto mb-6">
                            ${results.map((result, index) => `
                                <div class="p-4 border rounded-lg result-item ${result.isCorrect ? 'border-green-200 bg-green-50' : 'border-red-200 bg-red-50'}">
                                    <div class="flex justify-between items-start mb-2">
                                        <span class="font-medium">ç¬¬ ${index + 1} é¢˜</span>
                                        <span class="px-2 py-1 text-xs rounded-full ${result.isCorrect ? 'bg-green-100 text-green-600' : 'bg-red-100 text-red-600'}">
                                            ${result.isCorrect ? 'æ­£ç¡®' : 'é”™è¯¯'}
                                        </span>
                                    </div>
                                    <p class="text-sm text-gray-700 mb-2">${result.question}</p>
                                    <div class="text-sm mb-2">
                                        <div class="flex justify-between">
                                            <span>æ‚¨çš„ç­”æ¡ˆ: ${result.userAnswer}</span>
                                            <span>æ­£ç¡®ç­”æ¡ˆ: ${result.correctAnswer}</span>
                                        </div>
                                    </div>
                                    <div class="text-sm text-gray-600">
                                        <strong>è§£æ:</strong> ${result.explanation}
                                    </div>
                                </div>
                            `).join('')}
                        </div>
                        
                        <div class="flex gap-3">
                            <button id="review-practice" class="action-btn primary">
                                é‡æ–°ç»ƒä¹ 
                            </button>
                            <button id="back-to-papers" class="action-btn secondary">
                                è¿”å›è¯•å·åˆ—è¡¨
                            </button>
                        </div>
                    </div>
                `;

                // ç»‘å®šç»“æœé¡µé¢æŒ‰é’®äº‹ä»¶
                document.getElementById('review-practice').addEventListener('click', () => {
                    this.currentQuestionIndex = 0;
                    this.userAnswers = {};
                    this.showPracticeInterface();
                    this.loadCurrentQuestion();
                });

                document.getElementById('back-to-papers').addEventListener('click', () => {
                    this.showPapersList();
                });
            }

            // å¼€å§‹ç»ƒä¹ 
            startPractice() {
                // é»˜è®¤é€‰æ‹©ç¬¬ä¸€å¥—è¯•å·å¼€å§‹ç»ƒä¹ 
                const firstPaper = document.querySelector('.paper-item');
                if (firstPaper) {
                    const paperId = firstPaper.dataset.paperId;
                    this.startPaperPractice(paperId);
                } else {
                    this.showMessage('è¯·å…ˆåŠ è½½è¯•å·', 'warning');
                }
            }

            // æ˜¾ç¤ºç»Ÿè®¡
            showStats() {
                const statsModal = document.getElementById('stats-modal');
                const statsContent = document.getElementById('stats-content');
                
                if (statsModal && statsContent) {
                    statsContent.innerHTML = `
                        <div class="grid grid-cols-1 md:grid-cols-3 gap-4 mb-6">
                            <div class="bg-blue-50 p-4 rounded-lg text-center">
                                <h4 class="font-semibold text-blue-700 mb-2">ç»ƒä¹ æ¬¡æ•°</h4>
                                <p class="text-2xl font-bold text-blue-600">12</p>
                            </div>
                            <div class="bg-green-50 p-4 rounded-lg text-center">
                                <h4 class="font-semibold text-green-700 mb-2">å¹³å‡æ­£ç¡®ç‡</h4>
                                <p class="text-2xl font-bold text-green-600">78%</p>
                            </div>
                            <div class="bg-purple-50 p-4 rounded-lg text-center">
                                <h4 class="font-semibold text-purple-700 mb-2">æ€»ç»ƒä¹ é¢˜ç›®</h4>
                                <p class="text-2xl font-bold text-purple-600">156</p>
                            </div>
                        </div>
                        <div class="bg-white border border-gray-200 rounded-lg p-4">
                            <h4 class="font-semibold text-gray-800 mb-3">æœ€è¿‘ç»ƒä¹ è®°å½•</h4>
                            <div class="space-y-3">
                                <div class="flex justify-between items-center p-2 hover:bg-gray-50 rounded">
                                    <span>2023å¹´6æœˆå››çº§å¬åŠ›</span>
                                    <span class="px-2 py-1 bg-green-100 text-green-600 text-sm rounded">85%</span>
                                </div>
                                <div class="flex justify-between items-center p-2 hover:bg-gray-50 rounded">
                                    <span>2023å¹´12æœˆå››çº§å¬åŠ›</span>
                                    <span class="px-2 py-1 bg-green-100 text-green-600 text-sm rounded">76%</span>
                                </div>
                                <div class="flex justify-between items-center p-2 hover:bg-gray-50 rounded">
                                    <span>2022å¹´12æœˆå››çº§å¬åŠ›</span>
                                    <span class="px-2 py-1 bg-yellow-100 text-yellow-600 text-sm rounded">65%</span>
                                </div>
                            </div>
                        </div>
                    `;
                    
                    statsModal.classList.remove('hidden');
                }
            }

            // éšè—ç»Ÿè®¡æ¨¡æ€æ¡†
            hideStatsModal() {
                const statsModal = document.getElementById('stats-modal');
                if (statsModal) {
                    statsModal.classList.add('hidden');
                }
            }

            // æ˜¾ç¤ºæ¶ˆæ¯
            showMessage(message, type = 'info') {
                const toast = document.getElementById('message-toast');
                const icon = document.getElementById('message-icon');
                const text = document.getElementById('message-text');
                
                if (!toast || !icon || !text) return;
                
                // è®¾ç½®å›¾æ ‡å’Œé¢œè‰²
                const icons = {
                    success: 'fa-check-circle text-green-500',
                    error: 'fa-exclamation-circle text-red-500',
                    warning: 'fa-exclamation-triangle text-yellow-500',
                    info: 'fa-info-circle text-blue-500'
                };
                
                const borderColors = {
                    success: 'border-green-500',
                    error: 'border-red-500', 
                    warning: 'border-yellow-500',
                    info: 'border-blue-500'
                };
                
                icon.className = `fas ${icons[type] || icons.info} text-xl mr-3`;
                text.textContent = message;
                toast.className = `fixed top-4 right-4 z-50 bg-white rounded-lg shadow-lg ${borderColors[type] || borderColors.info} border-l-4 p-4 min-w-80 transform transition-all fade-in`;
                
                toast.classList.remove('hidden');
                
                // 3ç§’åè‡ªåŠ¨éšè—
                setTimeout(() => {
                    this.hideMessage();
                }, 3000);
            }

            hideMessage() {
                const toast = document.getElementById('message-toast');
                if (toast) {
                    toast.classList.add('hidden');
                }
            }
        }

        // å…¨å±€å‡½æ•°
        function hideMessage() {
            if (window.listeningManager) {
                window.listeningManager.hideMessage();
            }
        }

        // åˆå§‹åŒ–å¬åŠ›ç®¡ç†å™¨
        document.addEventListener('DOMContentLoaded', function() {
            console.log('ğŸ§ å¬åŠ›é¡µé¢åŠ è½½å®Œæˆï¼Œåˆå§‹åŒ–å¬åŠ›ç»ƒä¹ ç®¡ç†å™¨');
            window.listeningManager = new ListeningPracticeManager();
        });
    </script>
</body>
</html>