<!DOCTYPE html>
<html lang="zh">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>ä¸ªäººä¸­å¿ƒ - äº‘æ¢¦æ™ºé—´</title>
<script src="https://cdn.tailwindcss.com"></script>
<script>
tailwind.config = {
  theme: {
    extend: {
      colors: {
        primary: '#2962FF',
        secondary: '#1A237E',
        success: '#4CAF50',
        error: '#F44336',
        warning: '#FF9800'
      },
      borderRadius: {
        'button': '8px'
      },
      fontFamily: {
        'sans': ['Poppins', 'sans-serif']
      }
    }
  }
}
</script>
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
<link href="https://fonts.googleapis.com/css2?family=Poppins:wght@400;500;600;700&display=swap" rel="stylesheet">
<script src="https://cdnjs.cloudflare.com/ajax/libs/echarts/5.5.0/echarts.min.js"></script>
<style>
body {
  font-family: 'Poppins', sans-serif;
  background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
  min-height: 100vh;
}

.glass-effect {
  background: rgba(255, 255, 255, 0.95);
  backdrop-filter: blur(20px);
  border: 1px solid rgba(255, 255, 255, 0.2);
}

.progress-ring {
  width: 120px;
  height: 120px;
  border-radius: 50%;
  background: conic-gradient(#2962FF 0%, #E5E7EB 0%);
  position: relative;
  display: flex;
  align-items: center;
  justify-content: center;
}

.progress-ring-inner {
  width: 100px;
  height: 100px;
  background: white;
  border-radius: 50%;
  display: flex;
  align-items: center;
  justify-content: center;
  font-weight: bold;
  font-size: 1.5rem;
  color: '#2962FF';
}

.loading-skeleton {
  background: linear-gradient(90deg, #f0f0f0 25%, #e0e0e0 50%, #f0f0f0 75%);
  background-size: 200% 100%;
  animation: loading 1.5s infinite;
}

@keyframes loading {
  0% { background-position: 200% 0; }
  100% { background-position: -200% 0; }
}

.fade-in {
  animation: fadeIn 0.5s ease-in;
}

@keyframes fadeIn {
  from { opacity: 0; transform: translateY(20px); }
  to { opacity: 1; transform: translateY(0); }
}

.slide-in-right {
  animation: slideInRight 0.3s ease-out;
}

@keyframes slideInRight {
  from { transform: translateX(100%); opacity: 0; }
  to { transform: translateX(0); opacity: 1; }
}

.pulse-ring {
  animation: pulse 2s infinite;
}

@keyframes pulse {
  0% { box-shadow: 0 0 0 0 rgba(41, 98, 255, 0.7); }
  70% { box-shadow: 0 0 0 10px rgba(41, 98, 255, 0); }
  100% { box-shadow: 0 0 0 0 rgba(41, 98, 255, 0); }
}
</style>
</head>
<body class="min-h-screen bg-gray-50">
<!-- å¯¼èˆªæ  -->
<nav class="flex items-center justify-between px-6 lg:px-12 h-16 bg-white/90 backdrop-blur-md fixed top-0 left-0 right-0 z-50 border-b border-gray-200 shadow-sm">
    <div class="flex items-center gap-8 lg:gap-16">
        <a href="äº‘æ¢¦æ™ºé—´é¦–é¡µ.html" class="flex items-center gap-3">
            <span class="text-primary text-2xl font-bold tracking-tight">äº‘æ¢¦æ™ºé—´</span>
        </a>
        <div class="hidden lg:flex items-center gap-8">
            <a href="äº‘æ¢¦æ™ºé—´è®¡åˆ’.html" class="text-gray-700 hover:text-primary transition-colors font-medium">å¤‡è€ƒè§„åˆ’</a>
            <a href="äº‘æ¢¦æ™ºé—´æ•™å­¦.html" class="text-gray-700 hover:text-primary transition-colors font-medium">åœ¨çº¿æ•™å­¦</a>
            <a href="äº‘æ¢¦æ™ºé—´çœŸé¢˜.html" class="text-gray-700 hover:text-primary transition-colors font-medium">çœŸé¢˜ç»ƒä¹ </a>
            <a href="äº‘æ¢¦æ™ºé—´ç¤¾åŒº.html" class="text-gray-700 hover:text-primary transition-colors font-medium">å­¦ä¹ ç¤¾åŒº</a>
        </div>
    </div>
    
    <!-- åŠ¨æ€ç™»å½•/ç”¨æˆ·åŒºåŸŸ -->
    <div class="flex items-center gap-4 lg:gap-6" id="auth-section">
        <div id="login-btn-container">
            <!-- ç”±UIç®¡ç†å™¨åŠ¨æ€å¡«å…… -->
        </div>
    </div>
</nav>

<!-- ä¸»å†…å®¹åŒºåŸŸ -->
<div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 py-8 pt-24">
  <!-- è¿”å›æŒ‰é’®å’Œé¡µé¢æ ‡é¢˜ -->
  <div class="flex items-center justify-between mb-8">
    <a href="äº‘æ¢¦æ™ºé—´é¦–é¡µ.html" class="inline-flex items-center gap-2 px-6 py-3 bg-white rounded-button border border-gray-200 hover:bg-gray-50 transition-colors shadow-sm fade-in">
      <i class="fas fa-arrow-left"></i>
      è¿”å›é¦–é¡µ
    </a>
    <h1 class="text-3xl font-bold text-gray-900 fade-in">ä¸ªäººä¸­å¿ƒ</h1>
  </div>

  <!-- è®¤è¯çŠ¶æ€æç¤º -->
  <div id="auth-status-alert" class="hidden mb-6">
    <!-- åŠ¨æ€æ˜¾ç¤ºè®¤è¯çŠ¶æ€ä¿¡æ¯ -->
  </div>

  <!-- ç”¨æˆ·èµ„æ–™å¡ç‰‡ -->
  <div class="glass-effect rounded-2xl p-8 mb-8 shadow-2xl fade-in" id="user-profile-card">
    <div class="flex flex-col lg:flex-row items-center justify-between gap-6">
      <div class="flex items-center gap-6">
        <div class="relative group">
          <div class="w-24 h-24 rounded-full pulse-ring">
            <img id="user-avatar" src="" class="w-full h-full rounded-full object-cover border-4 border-white shadow-xl" alt="ç”¨æˆ·å¤´åƒ">
          </div>
          <div class="absolute inset-0 bg-black bg-opacity-50 rounded-full opacity-0 group-hover:opacity-100 flex items-center justify-center transition-all duration-300 cursor-pointer" id="avatar-upload-trigger">
            <i class="fas fa-camera text-white text-xl"></i>
          </div>
        </div>
        <div>
          <h1 id="user-name" class="text-2xl font-bold mb-2 loading-skeleton h-8 w-48 rounded">åŠ è½½ä¸­...</h1>
          <div class="flex flex-col sm:flex-row sm:items-center gap-3">
            <span id="member-badge" class="bg-gradient-to-r from-primary to-secondary text-white px-4 py-2 rounded-full text-sm font-medium flex items-center gap-2 shadow-lg w-fit">
              <i class="fas fa-crown"></i>
              <span id="member-level">åŠ è½½ä¼šå‘˜ç­‰çº§...</span>
            </span>
            <span id="user-id" class="text-gray-500 text-sm loading-skeleton h-5 w-32 rounded">ID: åŠ è½½ä¸­...</span>
          </div>
        </div>
      </div>
      <div class="text-center">
        <div class="progress-ring mx-auto">
          <div class="progress-ring-inner">
            <span id="goal-percent">0%</span>
          </div>
        </div>
        <p class="mt-3 text-gray-600 font-medium">å­¦ä¹ ç›®æ ‡å®Œæˆåº¦</p>
      </div>
    </div>
    
    <!-- æ•°æ®çŠ¶æ€æŒ‡ç¤º -->
    <div class="flex items-center gap-3 mt-4" id="data-status-indicator">
      <div class="flex items-center gap-2 text-sm text-gray-500">
        <i class="fas fa-database"></i>
        <span id="data-status-text">æ•°æ®åŠ è½½ä¸­...</span>
      </div>
    </div>
    
    <!-- ç”¨æˆ·æ“ä½œæŒ‰é’® -->
    <div class="flex flex-wrap gap-4 mt-8" id="user-actions">
      <button class="rounded-button flex items-center gap-3 px-6 py-3 bg-primary text-white hover:bg-secondary transition-all duration-300 shadow-lg hover:shadow-xl transform hover:-translate-y-1" id="edit-profile-btn">
        <i class="fas fa-user-edit"></i>
        <span>ç¼–è¾‘èµ„æ–™</span>
      </button>
      <button class="rounded-button flex items-center gap-3 px-6 py-3 border-2 border-gray-300 text-gray-700 hover:border-primary hover:text-primary transition-all duration-300" id="switch-account-btn">
        <i class="fas fa-exchange-alt"></i>
        <span>åˆ‡æ¢è´¦å·</span>
      </button>
      <a href="äº‘æ¢¦æ™ºé—´ä¼šå‘˜.html" class="rounded-button flex items-center gap-3 px-6 py-3 bg-gradient-to-r from-primary to-purple-600 text-white hover:opacity-90 transition-all duration-300 shadow-lg hover:shadow-xl transform hover:-translate-y-1">
        <i class="fas fa-crown"></i>
        <span>ä¼šå‘˜ä¸­å¿ƒ</span>
      </a>
      <button class="rounded-button flex items-center gap-3 px-6 py-3 bg-red-500 text-white hover:bg-red-600 transition-all duration-300" id="logout-btn">
        <i class="fas fa-sign-out-alt"></i>
        <span>é€€å‡ºç™»å½•</span>
      </button>
    </div>
  </div>

  <!-- å­¦ä¹ æ•°æ®ç»Ÿè®¡ -->
  <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-6 mb-8">
    <div class="glass-effect rounded-2xl p-6 shadow-lg fade-in" style="animation-delay: 0.1s">
      <div class="flex justify-between items-start mb-4">
        <h3 class="text-lg font-semibold text-gray-800">ç´¯è®¡å­¦ä¹ æ—¶é•¿</h3>
        <i class="fas fa-info-circle text-gray-400 cursor-help" title="åŒ…å«æ‰€æœ‰è¯¾ç¨‹çš„å­¦ä¹ æ—¶é—´"></i>
      </div>
      <div class="text-4xl font-bold text-primary mb-2 flex items-end">
        <span id="total-study-time" class="loading-skeleton h-12 w-24 rounded">--</span>
        <span class="text-xl ml-2 text-gray-600">å°æ—¶</span>
      </div>
      <div class="text-gray-500 text-sm">è¾ƒä¸Šå‘¨ <span class="text-green-500 font-medium" id="study-time-trend">â†‘ --%</span></div>
    </div>
    
    <div class="glass-effect rounded-2xl p-6 shadow-lg fade-in" style="animation-delay: 0.2s">
      <div class="flex justify-between items-start mb-4">
        <h3 class="text-lg font-semibold text-gray-800">æœ¬å‘¨æ´»è·ƒå¤©æ•°</h3>
        <i class="fas fa-info-circle text-gray-400 cursor-help" title="è¿ç»­å­¦ä¹ å¤©æ•°å°†è·å¾—é¢å¤–å¥–åŠ±"></i>
      </div>
      <div class="text-4xl font-bold text-primary mb-2 flex items-end">
        <span id="active-days" class="loading-skeleton h-12 w-12 rounded">--</span>
        <span class="text-xl ml-2 text-gray-600">å¤©</span>
      </div>
      <div class="text-gray-500 text-sm">è¿ç»­ç­¾åˆ° <span class="text-primary font-medium" id="checkin-days">-- å¤©</span></div>
    </div>
    
    <div class="glass-effect rounded-2xl p-6 shadow-lg fade-in" style="animation-delay: 0.3s">
      <div class="flex justify-between items-start mb-4">
        <h3 class="text-lg font-semibold text-gray-800">å·²æŒæ¡è¯æ±‡</h3>
        <i class="fas fa-info-circle text-gray-400 cursor-help" title="ç†Ÿç»ƒåº¦è¾¾åˆ°3çº§ä»¥ä¸Šçš„è¯æ±‡"></i>
      </div>
      <div class="text-4xl font-bold text-primary mb-2 flex items-end">
        <span id="mastered-words" class="loading-skeleton h-12 w-16 rounded">--</span>
        <span class="text-xl ml-2 text-gray-600">ä¸ª</span>
      </div>
      <div class="text-gray-500 text-sm">æ€»è®¡ <span id="total-words" class="font-medium">--</span> ä¸ªè¯æ±‡</div>
    </div>
    
    <div class="glass-effect rounded-2xl p-6 shadow-lg fade-in" style="animation-delay: 0.4s">
      <div class="flex justify-between items-start mb-4">
        <h3 class="text-lg font-semibold text-gray-800">ç»ƒä¹ æ­£ç¡®ç‡</h3>
        <i class="fas fa-info-circle text-gray-400 cursor-help" title="æ‰€æœ‰é¢˜å‹çš„å¹³å‡æ­£ç¡®ç‡"></i>
      </div>
      <div id="accuracyChart" class="h-24"></div>
    </div>
  </div>

  <!-- å­¦ä¹ æ¡£æ¡ˆå’ŒæŠ€èƒ½åˆ†æ -->
  <div class="glass-effect rounded-2xl p-8 mb-8 shadow-2xl fade-in">
    <div class="flex flex-col lg:flex-row lg:items-center lg:justify-between mb-8">
      <h2 class="text-2xl font-bold text-gray-900 mb-4 lg:mb-0">å­¦ä¹ æ¡£æ¡ˆåˆ†æ</h2>
      <div class="flex flex-wrap gap-3">
        <button class="rounded-button px-5 py-2.5 bg-primary text-white category-filter active" data-category="all">
          <i class="fas fa-layer-group mr-2"></i>å…¨éƒ¨
        </button>
        <button class="rounded-button px-5 py-2.5 border border-gray-300 text-gray-700 hover:border-primary hover:text-primary transition-colors category-filter" data-category="vocabulary">
          <i class="fas fa-book mr-2"></i>è¯æ±‡
        </button>
        <button class="rounded-button px-5 py-2.5 border border-gray-300 text-gray-700 hover:border-primary hover:text-primary transition-colors category-filter" data-category="listening">
          <i class="fas fa-headphones mr-2"></i>å¬åŠ›
        </button>
        <button class="rounded-button px-5 py-2.5 border border-gray-300 text-gray-700 hover:border-primary hover:text-primary transition-colors category-filter" data-category="reading">
          <i class="fas fa-book-open mr-2"></i>é˜…è¯»
        </button>
        <button class="rounded-button px-5 py-2.5 border border-gray-300 text-gray-700 hover:border-primary hover:text-primary transition-colors category-filter" data-category="writing">
          <i class="fas fa-pen mr-2"></i>å†™ä½œ
        </button>
      </div>
    </div>
    
    <div class="grid grid-cols-1 lg:grid-cols-2 gap-8">
      <!-- æŠ€èƒ½é›·è¾¾å›¾ -->
      <div>
        <h3 class="text-lg font-semibold mb-4 text-gray-800">èƒ½åŠ›è¯„ä¼°é›·è¾¾å›¾</h3>
        <div id="skillChart" class="h-80"></div>
        <!-- æŠ€èƒ½é›·è¾¾å›¾ç©ºçŠ¶æ€ -->
        <div id="skill-chart-empty" class="hidden text-center py-12">
          <div class="w-20 h-20 bg-gray-100 rounded-full flex items-center justify-center text-gray-400 text-2xl mx-auto mb-4">
            <i class="fas fa-chart-pie"></i>
          </div>
          <h3 class="text-lg font-semibold text-gray-700 mb-2">æš‚æ— èƒ½åŠ›è¯„ä¼°æ•°æ®</h3>
          <p class="text-gray-500 mb-4">å®Œæˆæ›´å¤šç»ƒä¹ åï¼Œç³»ç»Ÿå°†è‡ªåŠ¨ç”Ÿæˆèƒ½åŠ›è¯„ä¼°</p>
          <a href="äº‘æ¢¦æ™ºé—´æµ‹è¯•.html" class="inline-flex items-center gap-2 px-4 py-2 bg-primary text-white rounded-button hover:bg-secondary transition-colors text-sm">
            <i class="fas fa-play"></i>
            å¼€å§‹ç»ƒä¹ 
          </a>
        </div>
      </div>
      
      <!-- æœ€è¿‘ç»ƒä¹ è®°å½• -->
      <div>
        <div class="flex items-center justify-between mb-4">
          <h3 class="text-lg font-semibold text-gray-800">æœ€è¿‘ç»ƒä¹ è®°å½•</h3>
          <button class="text-primary hover:text-secondary text-sm font-medium flex items-center gap-1" id="refresh-records">
            <i class="fas fa-redo-alt text-xs"></i>
            åˆ·æ–°
          </button>
        </div>
        <div class="space-y-4 max-h-80 overflow-y-auto pr-2" id="recent-records">
          <!-- åŠ¨æ€å¡«å……ç»ƒä¹ è®°å½• -->
          <div class="loading-skeleton h-20 rounded-xl"></div>
          <div class="loading-skeleton h-20 rounded-xl"></div>
          <div class="loading-skeleton h-20 rounded-xl"></div>
        </div>
        <!-- æœ€è¿‘ç»ƒä¹ è®°å½•ç©ºçŠ¶æ€ -->
        <div id="records-empty" class="hidden text-center py-8">
          <div class="w-16 h-16 bg-gray-100 rounded-full flex items-center justify-center text-gray-400 text-xl mx-auto mb-4">
            <i class="fas fa-history"></i>
          </div>
          <p class="text-gray-600 mb-2">æš‚æ— ç»ƒä¹ è®°å½•</p>
          <p class="text-sm text-gray-500 mb-4">å¼€å§‹å­¦ä¹ åï¼Œè®°å½•å°†æ˜¾ç¤ºåœ¨è¿™é‡Œ</p>
          <div class="flex gap-3 justify-center">
            <a href="äº‘æ¢¦æ™ºé—´è¯æ±‡.html" class="px-4 py-2 bg-primary text-white rounded-button hover:bg-secondary transition-colors text-sm">
              è¯æ±‡ç»ƒä¹ 
            </a>
            <a href="äº‘æ¢¦æ™ºé—´å¬åŠ›.html" class="px-4 py-2 border border-gray-300 text-gray-700 rounded-button hover:bg-gray-50 transition-colors text-sm">
              å¬åŠ›è®­ç»ƒ
            </a>
          </div>
        </div>
      </div>
    </div>
  </div>

  <!-- ä¼šå‘˜ç‰¹æƒ -->
  <div class="glass-effect rounded-2xl p-8 shadow-2xl fade-in">
    <div class="flex flex-col lg:flex-row lg:items-center lg:justify-between mb-8">
      <h2 class="text-2xl font-bold text-gray-900 mb-4 lg:mb-0">ä¼šå‘˜ç‰¹æƒ</h2>
      <div class="flex items-center gap-3 text-gray-600 bg-blue-50 px-4 py-2 rounded-full">
        <i class="far fa-clock text-primary"></i>
        <span>å‰©ä½™ <span id="member-days-left" class="font-semibold text-primary">--</span> å¤©</span>
      </div>
    </div>
    
    <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-6 mb-8">
      <div class="p-6 border-2 border-primary rounded-2xl bg-gradient-to-br from-blue-50 to-white transition-all duration-300 hover:shadow-lg hover:-translate-y-1">
        <div class="w-12 h-12 bg-primary rounded-xl flex items-center justify-center text-white text-xl mb-4">
          <i class="fas fa-robot"></i>
        </div>
        <h3 class="font-semibold text-gray-800 mb-2">AI åŠ©æ•™</h3>
        <p class="text-gray-600 text-sm leading-relaxed">æ™ºèƒ½æ‰¹æ”¹å’Œä¸ªæ€§åŒ–å­¦ä¹ æŒ‡å¯¼ï¼Œ24å°æ—¶åœ¨çº¿ç­”ç–‘</p>
      </div>
      
      <div class="p-6 border-2 border-primary rounded-2xl bg-gradient-to-br from-blue-50 to-white transition-all duration-300 hover:shadow-lg hover:-translate-y-1">
        <div class="w-12 h-12 bg-primary rounded-xl flex items-center justify-center text-white text-xl mb-4">
          <i class="fas fa-book-reader"></i>
        </div>
        <h3 class="font-semibold text-gray-800 mb-2">ä¸“å±è¯¾ç¨‹</h3>
        <p class="text-gray-600 text-sm leading-relaxed">ç‹¬å®¶å®šåˆ¶å­¦ä¹ è®¡åˆ’ï¼Œé’ˆå¯¹æ€§æå‡è–„å¼±ç¯èŠ‚</p>
      </div>
      
      <div class="p-6 border-2 border-yellow-400 rounded-2xl bg-gradient-to-br from-yellow-50 to-white transition-all duration-300 hover:shadow-lg hover:-translate-y-1">
        <div class="w-12 h-12 bg-yellow-400 rounded-xl flex items-center justify-center text-white text-xl mb-4">
          <i class="fas fa-video"></i>
        </div>
        <h3 class="font-semibold text-gray-800 mb-2">ç›´æ’­è¯¾ç¨‹</h3>
        <p class="text-gray-600 text-sm leading-relaxed">åå¸ˆç›´æ’­æˆè¯¾ï¼Œå®æ—¶äº’åŠ¨ç­”ç–‘ï¼Œé”™è¿‡å¯å›çœ‹</p>
      </div>
      
      <div class="p-6 border-2 border-purple-500 rounded-2xl bg-gradient-to-br from-purple-50 to-white transition-all duration-300 hover:shadow-lg hover:-translate-y-1">
        <div class="w-12 h-12 bg-purple-500 rounded-xl flex items-center justify-center text-white text-xl mb-4">
          <i class="fas fa-chart-line"></i>
        </div>
        <h3 class="font-semibold text-gray-800 mb-2">å­¦ä¹ åˆ†æ</h3>
        <p class="text-gray-600 text-sm leading-relaxed">æ·±åº¦å­¦ä¹ æ•°æ®åˆ†æï¼Œæ™ºèƒ½é¢„æµ‹å­¦ä¹ æ•ˆæœ</p>
      </div>
    </div>
    
    <div class="text-center pt-4">
      <a href="äº‘æ¢¦æ™ºé—´ä¼šå‘˜.html" class="inline-flex items-center gap-3 px-8 py-4 bg-gradient-to-r from-primary to-purple-600 text-white rounded-button hover:opacity-90 transition-all duration-300 shadow-lg hover:shadow-xl transform hover:-translate-y-1 text-lg font-semibold">
        <i class="fas fa-crown"></i>
        ç«‹å³å‡çº§è‡³å¹´åº¦ä¼šå‘˜
        <i class="fas fa-arrow-right"></i>
      </a>
      <p class="text-gray-500 text-sm mt-3">å‡çº§åç«‹å³è§£é”æ‰€æœ‰ç‰¹æƒï¼Œäº«å—æ›´å¥½çš„å­¦ä¹ ä½“éªŒ</p>
    </div>
  </div>
</div>

<!-- ç¼–è¾‘èµ„æ–™æ¨¡æ€æ¡† -->
<div id="edit-profile-modal" class="fixed inset-0 bg-black/50 flex items-center justify-center z-50 hidden">
  <div class="bg-white rounded-2xl p-8 w-full max-w-md mx-4 shadow-2xl transform transition-all duration-300 scale-95">
    <div class="flex items-center justify-between mb-6">
      <h3 class="text-xl font-bold text-gray-900">ç¼–è¾‘ä¸ªäººèµ„æ–™</h3>
      <button id="close-edit-modal" class="text-gray-400 hover:text-gray-600 transition-colors">
        <i class="fas fa-times text-xl"></i>
      </button>
    </div>
    
    <form id="profile-form" class="space-y-5">
      <div>
        <label class="block text-sm font-medium text-gray-700 mb-2">å§“å</label>
        <input type="text" id="edit-name" class="w-full px-4 py-3 border border-gray-300 rounded-xl focus:outline-none focus:border-primary focus:ring-2 focus:ring-primary/20 transition-all" required>
      </div>
      
      <div>
        <label class="block text-sm font-medium text-gray-700 mb-2">æ‰‹æœºå·</label>
        <input type="tel" id="edit-phone" class="w-full px-4 py-3 border border-gray-300 rounded-xl focus:outline-none focus:border-primary focus:ring-2 focus:ring-primary/20 transition-all" placeholder="è¯·è¾“å…¥æ‰‹æœºå·ç ">
      </div>
      
      <div>
        <label class="block text-sm font-medium text-gray-700 mb-2">å¤´åƒURL</label>
        <input type="url" id="edit-avatar" class="w-full px-4 py-3 border border-gray-300 rounded-xl focus:outline-none focus:border-primary focus:ring-2 focus:ring-primary/20 transition-all" placeholder="è¯·è¾“å…¥å¤´åƒå›¾ç‰‡é“¾æ¥">
        <p class="text-xs text-gray-500 mt-1">æ”¯æŒ jpg, png ç­‰æ ¼å¼çš„å›¾ç‰‡é“¾æ¥</p>
      </div>
      
      <div class="flex gap-3 pt-2">
        <button type="button" id="cancel-edit" class="flex-1 px-4 py-3 bg-gray-100 text-gray-700 rounded-xl hover:bg-gray-200 transition-colors font-medium">
          å–æ¶ˆ
        </button>
        <button type="submit" class="flex-1 px-4 py-3 bg-primary text-white rounded-xl hover:bg-secondary transition-colors font-medium flex items-center justify-center gap-2">
          <i class="fas fa-save"></i>
          ä¿å­˜æ›´æ”¹
        </button>
      </div>
    </form>
  </div>
</div>

<!-- åŠ è½½é®ç½© -->
<div id="loading-overlay" class="fixed inset-0 bg-black/50 flex items-center justify-center z-50 hidden">
  <div class="bg-white rounded-2xl p-8 w-full max-w-sm mx-4 text-center">
    <div class="animate-spin rounded-full h-12 w-12 border-b-2 border-primary mx-auto mb-4"></div>
    <p class="text-gray-700 font-medium" id="loading-message">åŠ è½½ä¸­...</p>
  </div>
</div>

<!-- æ ¸å¿ƒç³»ç»Ÿæ–‡ä»¶ -->
<script src="äº‘æ¢¦æ™ºé—´ç»Ÿä¸€è®¤è¯.js"></script>
<script src="äº‘æ¢¦æ™ºé—´UIç®¡ç†å™¨.js"></script>
<script src="äº‘æ¢¦æ™ºé—´ä¸»å…¥å£.js"></script>

<script>
// å¢å¼ºçš„ç”¨æˆ·èµ„æ–™ç®¡ç†å™¨ - ä¸å…¨å±€è®¤è¯ç³»ç»ŸåŒæ­¥ç‰ˆæœ¬
class EnhancedUserProfileManager {
  constructor() {
    this.authManager = window.unifiedAuthManager;
    this.uiManager = window.uiManager;
    this.userData = null;
    this.charts = {};
    this.isInitialized = false;
    this.currentFilter = 'all';
    this.dataStatus = 'loading'; // loading, empty, loaded, error
    
    this.init();
  }

  async init() {
    try {
      console.log('ğŸš€ åˆå§‹åŒ–ç”¨æˆ·èµ„æ–™ç®¡ç†å™¨...');
      
      // æ˜¾ç¤ºåŠ è½½çŠ¶æ€
      this.showLoading('åˆå§‹åŒ–ç”¨æˆ·ä¸­å¿ƒ...');
      
      // ç­‰å¾…è®¤è¯ç³»ç»Ÿå°±ç»ª
      await this.waitForAuthSystem();
      
      // æ£€æŸ¥ç™»å½•çŠ¶æ€ - ä¸å…¨å±€è®¤è¯ç³»ç»ŸåŒæ­¥
      if (!this.authManager.isLoggedIn()) {
        this.showAuthRequired();
        this.hideLoading();
        return;
      }
      
      // åˆå§‹åŒ–äº‹ä»¶ç›‘å¬
      this.initEventListeners();
      
      // ä»å…¨å±€è®¤è¯ç³»ç»Ÿè·å–ç”¨æˆ·æ•°æ®
      await this.loadUserDataFromAuthSystem();
      
      // åˆå§‹åŒ–å›¾è¡¨
      this.initCharts();
      
      this.isInitialized = true;
      this.hideLoading();
      
      console.log('âœ… ç”¨æˆ·èµ„æ–™ç®¡ç†å™¨åˆå§‹åŒ–å®Œæˆ');
      
    } catch (error) {
      console.error('âŒ ç”¨æˆ·èµ„æ–™ç®¡ç†å™¨åˆå§‹åŒ–å¤±è´¥:', error);
      this.hideLoading();
      this.showError('åˆå§‹åŒ–å¤±è´¥ï¼Œè¯·åˆ·æ–°é¡µé¢é‡è¯•');
    }
  }

  // ç­‰å¾…è®¤è¯ç³»ç»Ÿå°±ç»ª
  waitForAuthSystem() {
    return new Promise((resolve, reject) => {
      const maxWaitTime = 10000; // 10ç§’è¶…æ—¶
      const startTime = Date.now();
      
      const checkAuth = () => {
        if (this.authManager && this.authManager.isInitialized) {
          resolve();
        } else if (Date.now() - startTime > maxWaitTime) {
          reject(new Error('è®¤è¯ç³»ç»Ÿåˆå§‹åŒ–è¶…æ—¶'));
        } else {
          setTimeout(checkAuth, 100);
        }
      };
      
      checkAuth();
    });
  }

  // å¢å¼ºçš„æ•°æ®è·å–æ–¹æ³• - ç›´æ¥ä»æ•°æ®åº“APIè·å–çœŸå®æ•°æ®
  async loadUserDataFromAuthSystem() {
    try {
      this.showLoading('åŠ è½½ç”¨æˆ·æ•°æ®...');
      this.setDataStatus('loading');
      
      const currentUser = this.authManager.getCurrentUser();
      const authState = this.authManager.getAuthState();
      
      if (!currentUser) {
        throw new Error('ç”¨æˆ·æ•°æ®ä¸å­˜åœ¨');
      }
      
      // å¹¶è¡Œè·å–å„ç§æ•°æ® - ä½¿ç”¨çœŸå®çš„æ•°æ®åº“API
      const [userStats, recentRecords, skillLevels, checkinInfo, vocabularyStats] = await Promise.all([
        this.fetchUserStats(),
        this.fetchRecentRecords(),
        this.fetchSkillLevels(),
        this.fetchCheckinInfo(),
        this.fetchVocabularyStats()
      ]);
      
      this.userData = {
        user: {
          id: currentUser.id || 12345,
          username: currentUser.username || 'user12345',
          name: currentUser.name || 'ç”¨æˆ·',
          phone: currentUser.phone || '',
          avatar: currentUser.avatar || this.authManager.generateDefaultAvatar(currentUser.name || currentUser.username),
          memberLevel: currentUser.memberLevel || 'basic',
          memberDaysLeft: currentUser.memberDaysLeft || 30
        },
        stats: this.formatLearningStats(userStats),
        recentRecords: recentRecords,
        skillLevels: skillLevels,
        weeklyAccuracy: this.generateWeeklyAccuracy(userStats),
        checkinInfo: checkinInfo,
        vocabularyStats: vocabularyStats
      };
      
      // æ£€æŸ¥æ•°æ®çŠ¶æ€
      this.checkDataStatus();
      this.renderUserData();
      
    } catch (error) {
      console.error('âŒ ä»è®¤è¯ç³»ç»ŸåŠ è½½ç”¨æˆ·æ•°æ®å¤±è´¥:', error);
      await this.loadFallbackUserData();
      this.setDataStatus('error');
    } finally {
      this.hideLoading();
    }
  }

  // ä»æ•°æ®åº“APIè·å–ç”¨æˆ·ç»Ÿè®¡æ•°æ®
  async fetchUserStats() {
    try {
      const response = await fetch('/api/user/stats', {
        headers: this.authManager.getAuthHeaders()
      });
      
      if (response.ok) {
        const result = await response.json();
        if (result.success) {
          return result.data;
        }
      }
    } catch (error) {
      console.log('è·å–ç”¨æˆ·ç»Ÿè®¡å¤±è´¥:', error);
    }
    
    // è¿”å›é›¶æ•°æ®çŠ¶æ€
    return {
      totalStudyTime: 0,
      activeDays: 0,
      masteredWords: 0,
      totalWords: 5000,
      goalCompletion: 0,
      weekStudyTime: 0,
      lastWeekStudyTime: 0,
      streak: 0
    };
  }

  // ä»æ•°æ®åº“APIè·å–æŠ€èƒ½æ°´å¹³æ•°æ®
  async fetchSkillLevels() {
    try {
      const response = await fetch('/api/user/skill-levels', {
        headers: this.authManager.getAuthHeaders()
      });
      
      if (response.ok) {
        const result = await response.json();
        if (result.success) {
          return result.data;
        }
      }
    } catch (error) {
      console.log('è·å–æŠ€èƒ½æ°´å¹³å¤±è´¥:', error);
    }
    
    // è¿”å›é›¶æ•°æ®çŠ¶æ€
    return {
      'è¯æ±‡é‡': 0,
      'å¬åŠ›ç†è§£': 0,
      'é˜…è¯»é€Ÿåº¦': 0,
      'è¯­æ³•æŒæ¡': 0,
      'å†™ä½œèƒ½åŠ›': 0
    };
  }

  // ä»æ•°æ®åº“APIè·å–è¯æ±‡ç»Ÿè®¡æ•°æ®
  async fetchVocabularyStats() {
    try {
      const userId = this.authManager.getCurrentUser()?.id;
      if (!userId) return {};
      
      const response = await fetch(`/api/vocabulary/user-stats/${userId}`, {
        headers: this.authManager.getAuthHeaders()
      });
      
      if (response.ok) {
        const result = await response.json();
        if (result.success) {
          return result.data.statistics || {};
        }
      }
    } catch (error) {
      console.log('è·å–è¯æ±‡ç»Ÿè®¡å¤±è´¥:', error);
    }
    
    return {};
  }

  // æ ¼å¼åŒ–å­¦ä¹ ç»Ÿè®¡
  formatLearningStats(learningProgress) {
    return {
      totalStudyTime: learningProgress.totalStudyTime || 0,
      activeDays: learningProgress.activeDays || 0,
      masteredWords: learningProgress.masteredWords || 0,
      totalWords: learningProgress.totalWords || 5000,
      goalCompletion: learningProgress.goalCompletion || 0,
      weekStudyTime: learningProgress.weekStudyTime || 0,
      lastWeekStudyTime: learningProgress.lastWeekStudyTime || 0,
      streak: learningProgress.streak || 0
    };
  }

  // ç”Ÿæˆå‘¨å‡†ç¡®ç‡æ•°æ®
  generateWeeklyAccuracy(stats) {
    const base = stats && stats.weekStudyTime > 0 ? 75 : 0;
    return Array.from({length: 7}, (_, i) => base + Math.floor(Math.random() * 20));
  }

  // è·å–æœ€è¿‘å­¦ä¹ è®°å½• - ä»æ•°æ®åº“API
  async fetchRecentRecords() {
    try {
      const response = await fetch('/api/user/recent-records', {
        headers: this.authManager.getAuthHeaders()
      });
      
      if (response.ok) {
        const result = await response.json();
        if (result.success) {
          return result.data.records || [];
        }
      }
    } catch (error) {
      console.log('è·å–æœ€è¿‘å­¦ä¹ è®°å½•å¤±è´¥:', error);
    }
    
    // é™çº§ï¼šè¿”å›æ¨¡æ‹Ÿæ•°æ®
    return this.generateMockRecords();
  }

  // ç”Ÿæˆæ¨¡æ‹Ÿè®°å½•æ•°æ®
  generateMockRecords() {
    const activities = ['vocabulary', 'listening', 'reading', 'writing', 'grammar'];
    const titles = [
      'è¯æ±‡è®°å¿†è®­ç»ƒ', 'å¬åŠ›ç†è§£ç»ƒä¹ ', 'é˜…è¯»ç†è§£æµ‹è¯•', 'å†™ä½œæŠ€èƒ½è®­ç»ƒ', 'è¯­æ³•ä¸“é¡¹ç»ƒä¹ ',
      'å››çº§çœŸé¢˜æ¨¡æ‹Ÿ', 'å…­çº§è¯æ±‡çªç ´', 'å£è¯­å‘éŸ³ç»ƒä¹ ', 'ç¿»è¯‘æŠ€å·§è®­ç»ƒ'
    ];
    
    return Array.from({length: 5}, (_, i) => ({
      id: i + 1,
      studyType: activities[Math.floor(Math.random() * activities.length)],
      title: titles[Math.floor(Math.random() * titles.length)],
      duration: Math.floor(Math.random() * 60) + 10,
      accuracy: Math.floor(Math.random() * 40) + 60,
      date: new Date(Date.now() - Math.random() * 7 * 24 * 60 * 60 * 1000).toISOString(),
      wrongQuestions: Math.floor(Math.random() * 5)
    }));
  }

  // è·å–ç­¾åˆ°ä¿¡æ¯ - ä»æ•°æ®åº“API
  async fetchCheckinInfo() {
    try {
      const response = await fetch('/api/user/checkin-info', {
        headers: this.authManager.getAuthHeaders()
      });
      
      if (response.ok) {
        const result = await response.json();
        if (result.success) {
          return result.data;
        }
      }
    } catch (error) {
      console.log('è·å–ç­¾åˆ°ä¿¡æ¯å¤±è´¥:', error);
    }
    
    // é™çº§ï¼šè¿”å›æ¨¡æ‹Ÿæ•°æ®
    return {
      todayChecked: false,
      currentStreak: 0,
      weekCheckins: 0,
      maxStreak: 0
    };
  }

  // å¢å¼ºçš„é™çº§æ•°æ®åŠ è½½ - è¿”å›çœŸå®çš„é›¶æ•°æ®
  async loadFallbackUserData() {
    const currentUser = this.authManager.getCurrentUser();
    
    this.userData = {
      user: {
        id: currentUser?.id || 12345,
        username: currentUser?.username || 'user12345',
        name: currentUser?.name || 'ç”¨æˆ·',
        phone: currentUser?.phone || '',
        avatar: currentUser?.avatar || this.authManager.generateDefaultAvatar(currentUser?.name || currentUser?.username),
        memberLevel: currentUser?.memberLevel || 'basic',
        memberDaysLeft: currentUser?.memberDaysLeft || 30
      },
      stats: {
        totalStudyTime: 0,
        activeDays: 0,
        masteredWords: 0,
        totalWords: 5000,
        goalCompletion: 0,
        weekStudyTime: 0,
        lastWeekStudyTime: 0,
        streak: 0
      },
      recentRecords: this.generateMockRecords(),
      skillLevels: {
        'è¯æ±‡é‡': 0,
        'å¬åŠ›ç†è§£': 0,
        'é˜…è¯»é€Ÿåº¦': 0,
        'è¯­æ³•æŒæ¡': 0,
        'å†™ä½œèƒ½åŠ›': 0
      },
      weeklyAccuracy: Array(7).fill(0),
      checkinInfo: {
        todayChecked: false,
        currentStreak: 0,
        weekCheckins: 0,
        maxStreak: 0
      },
      vocabularyStats: {
        totalWordsLearned: 0,
        masteredWords: 0,
        wordsToReview: 0,
        todayWords: 0,
        accuracyRate: 0,
        streakDays: 0,
        totalStudyDays: 0,
        totalVocabulary: 0
      }
    };
    
    this.checkDataStatus();
    this.renderUserData();
  }

  // æ£€æŸ¥æ•°æ®çŠ¶æ€
  checkDataStatus() {
    if (!this.userData) {
      this.setDataStatus('empty');
      return;
    }
    
    const { stats, recentRecords, skillLevels } = this.userData;
    
    // æ£€æŸ¥æ˜¯å¦æœ‰æœ‰æ•ˆæ•°æ®
    const hasStats = stats && (
      stats.totalStudyTime > 0 || 
      stats.masteredWords > 0 || 
      stats.activeDays > 0
    );
    
    const hasRecords = recentRecords && recentRecords.length > 0;
    const hasSkills = skillLevels && Object.values(skillLevels).some(level => level > 0);
    
    if (!hasStats && !hasRecords && !hasSkills) {
      this.setDataStatus('empty');
    } else {
      this.setDataStatus('loaded');
    }
  }

  // è®¾ç½®æ•°æ®çŠ¶æ€
  setDataStatus(status) {
    this.dataStatus = status;
    const statusElement = document.getElementById('data-status-indicator');
    const statusText = document.getElementById('data-status-text');
    
    if (!statusElement || !statusText) return;
    
    const statusConfig = {
      loading: { text: 'æ•°æ®åŠ è½½ä¸­...', color: 'text-blue-500', icon: 'sync fa-spin' },
      empty: { text: 'æš‚æ— å­¦ä¹ æ•°æ®', color: 'text-gray-500', icon: 'info-circle' },
      loaded: { text: 'æ•°æ®å·²åŠ è½½', color: 'text-green-500', icon: 'check-circle' },
      error: { text: 'æ•°æ®åŠ è½½å¤±è´¥', color: 'text-red-500', icon: 'exclamation-circle' }
    };
    
    const config = statusConfig[status] || statusConfig.loading;
    
    statusText.className = `text-sm ${config.color}`;
    statusText.innerHTML = `<i class="fas fa-${config.icon} mr-1"></i>${config.text}`;
  }

  // æ˜¾ç¤ºè®¤è¯è¦æ±‚æç¤º
  showAuthRequired() {
    const profileCard = document.getElementById('user-profile-card');
    if (profileCard) {
      profileCard.innerHTML = `
        <div class="text-center py-12">
          <div class="w-20 h-20 bg-gray-200 rounded-full flex items-center justify-center text-gray-400 text-2xl mx-auto mb-4">
            <i class="fas fa-user-slash"></i>
          </div>
          <h3 class="text-xl font-semibold text-gray-700 mb-2">è¯·å…ˆç™»å½•</h3>
          <p class="text-gray-500 mb-6">ç™»å½•åå³å¯æŸ¥çœ‹ä¸ªäººä¸­å¿ƒä¿¡æ¯</p>
          <div class="flex justify-center gap-4">
            <a href="äº‘æ¢¦æ™ºé—´ç™»å½•.html" class="px-6 py-3 bg-primary text-white rounded-button hover:bg-secondary transition-colors">
              <i class="fas fa-sign-in-alt mr-2"></i>ç«‹å³ç™»å½•
            </a>
            <a href="äº‘æ¢¦æ™ºé—´é¦–é¡µ.html" class="px-6 py-3 border border-gray-300 text-gray-700 rounded-button hover:bg-gray-50 transition-colors">
              <i class="fas fa-home mr-2"></i>è¿”å›é¦–é¡µ
            </a>
          </div>
        </div>
      `;
    }
    
    // éšè—å…¶ä»–å†…å®¹åŒºåŸŸ
    document.querySelectorAll('.glass-effect').forEach(el => {
      if (el !== profileCard) {
        el.style.display = 'none';
      }
    });
  }

  // å¢å¼ºçš„æ¸²æŸ“æ–¹æ³• - ä½¿ç”¨çœŸå®æ•°æ®åº“æ•°æ®
  renderUserData() {
    if (!this.userData) return;

    const { user, stats, recentRecords, skillLevels, weeklyAccuracy, checkinInfo, vocabularyStats } = this.userData;

    // æ¸²æŸ“ç”¨æˆ·åŸºæœ¬ä¿¡æ¯
    this.updateAvatar('user-avatar', user.avatar);
    this.updateElement('user-name', user.name || 'æœªè®¾ç½®å§“å');
    this.updateElement('member-level', this.getMemberLevelText(user.memberLevel));
    this.updateElement('user-id', `ID: ${user.username}`);
    
    // æ›´æ–°ä¼šå‘˜å¾½ç« æ ·å¼
    this.updateMemberBadge(user.memberLevel);

    // æ¸²æŸ“å­¦ä¹ ç›®æ ‡è¿›åº¦ - ä½¿ç”¨è¯æ±‡ç»Ÿè®¡æ•°æ®
    const goalCompletion = vocabularyStats.goalCompletion || stats?.goalCompletion || 0;
    this.updateProgressRing(goalCompletion);
    this.updateElement('goal-percent', `${goalCompletion}%`);

    // æ¸²æŸ“ç»Ÿè®¡æ•°æ® - ä¼˜å…ˆä½¿ç”¨è¯æ±‡ç»Ÿè®¡æ•°æ®
    const totalStudyTime = stats?.totalStudyTime || 0;
    const activeDays = stats?.activeDays || 0;
    const masteredWords = vocabularyStats.masteredWords || stats?.masteredWords || 0;
    const totalWords = vocabularyStats.totalVocabulary || stats?.totalWords || 5000;
    
    this.updateElement('total-study-time', totalStudyTime > 0 ? totalStudyTime : '0');
    this.updateElement('active-days', activeDays > 0 ? activeDays : '0');
    this.updateElement('mastered-words', masteredWords > 0 ? masteredWords : '0');
    this.updateElement('total-words', totalWords || '5000');
    this.updateElement('member-days-left', user.memberDaysLeft || '0');
    
    // æ›´æ–°ç­¾åˆ°ä¿¡æ¯
    this.updateElement('checkin-days', checkinInfo?.currentStreak || '0');

    // è®¡ç®—å¹¶æ˜¾ç¤ºå­¦ä¹ è¶‹åŠ¿
    this.updateStudyTrend(stats);

    // æ¸²æŸ“æœ€è¿‘ç»ƒä¹ è®°å½• - ä½¿ç”¨çœŸå®æ•°æ®
    this.renderRecentRecords(recentRecords || []);

    // æ›´æ–°å›¾è¡¨æ•°æ® - ä½¿ç”¨çœŸå®æŠ€èƒ½æ•°æ®
    this.updateCharts(
      weeklyAccuracy || Array(7).fill(0), 
      skillLevels || {}
    );

    // æ ¹æ®æ•°æ®çŠ¶æ€æ˜¾ç¤º/éšè—ç©ºçŠ¶æ€
    this.toggleEmptyStates();

    // ç§»é™¤åŠ è½½éª¨æ¶
    this.removeSkeletons();
  }

  // åˆ‡æ¢ç©ºçŠ¶æ€æ˜¾ç¤º
  toggleEmptyStates() {
    const { stats, recentRecords, skillLevels } = this.userData;
    
    // æŠ€èƒ½å›¾è¡¨ç©ºçŠ¶æ€
    const skillChartEmpty = document.getElementById('skill-chart-empty');
    const skillChart = document.getElementById('skillChart');
    const hasSkillData = skillLevels && Object.values(skillLevels).some(level => level > 0);
    
    if (skillChartEmpty && skillChart) {
      if (hasSkillData) {
        skillChartEmpty.classList.add('hidden');
        skillChart.classList.remove('hidden');
      } else {
        skillChartEmpty.classList.remove('hidden');
        skillChart.classList.add('hidden');
      }
    }
    
    // ç»ƒä¹ è®°å½•ç©ºçŠ¶æ€
    const recordsEmpty = document.getElementById('records-empty');
    const recordsContainer = document.getElementById('recent-records');
    const hasRecords = recentRecords && recentRecords.length > 0;
    
    if (recordsEmpty && recordsContainer) {
      if (hasRecords) {
        recordsEmpty.classList.add('hidden');
        recordsContainer.classList.remove('hidden');
      } else {
        recordsEmpty.classList.remove('hidden');
        recordsContainer.classList.add('hidden');
      }
    }
    
    // ç»Ÿè®¡æ•°æ®ç©ºçŠ¶æ€æç¤º
    this.updateStatsEmptyState(stats);
  }

  // æ›´æ–°ç»Ÿè®¡æ•°æ®ç©ºçŠ¶æ€
  updateStatsEmptyState(stats) {
    const statCards = document.querySelectorAll('.glass-effect .text-4xl');
    const hasData = stats && (
      stats.totalStudyTime > 0 || 
      stats.masteredWords > 0 || 
      stats.activeDays > 0
    );
    
    if (!hasData) {
      statCards.forEach(card => {
        if (card.textContent === '0' || card.textContent === '--') {
          const parent = card.closest('.glass-effect');
          if (parent) {
            parent.classList.add('opacity-70');
            // æ·»åŠ æç¤ºæ–‡å­—
            const trendElement = parent.querySelector('.text-gray-500');
            if (trendElement && !trendElement.querySelector('.empty-hint')) {
              const hint = document.createElement('div');
              hint.className = 'empty-hint text-xs text-gray-400 mt-1';
              hint.textContent = 'æš‚æ— æ•°æ®ï¼Œå¼€å§‹å­¦ä¹ åæ›´æ–°';
              trendElement.appendChild(hint);
            }
          }
        }
      });
    }
  }

  // æ›´æ–°å¤´åƒï¼ˆå¸¦é”™è¯¯å¤„ç†ï¼‰
  updateAvatar(elementId, avatarUrl) {
    const element = document.getElementById(elementId);
    if (!element) return;
    
    const defaultAvatar = 'https://ui-avatars.com/api/?name=User&background=2962FF&color=fff&size=128';
    
    if (avatarUrl) {
      element.src = avatarUrl;
      element.onerror = () => {
        element.src = defaultAvatar;
      };
    } else {
      element.src = defaultAvatar;
    }
    element.classList.remove('loading-skeleton');
  }

  // æ›´æ–°å…ƒç´ å†…å®¹
  updateElement(id, content) {
    const element = document.getElementById(id);
    if (element) {
      element.textContent = content;
      element.classList.remove('loading-skeleton');
    }
  }

  // æ›´æ–°ä¼šå‘˜å¾½ç« 
  updateMemberBadge(memberLevel) {
    const badge = document.getElementById('member-badge');
    if (!badge) return;

    const levels = {
      'vip': { color: 'from-yellow-400 to-orange-500', icon: 'crown', text: 'VIPä¼šå‘˜' },
      'premium': { color: 'from-purple-500 to-pink-500', icon: 'gem', text: 'é«˜çº§ä¼šå‘˜' },
      'basic': { color: 'from-blue-500 to-blue-700', icon: 'user', text: 'æ™®é€šä¼šå‘˜' }
    };

    const levelConfig = levels[memberLevel] || levels.basic;
    
    badge.className = `bg-gradient-to-r ${levelConfig.color} text-white px-4 py-2 rounded-full text-sm font-medium flex items-center gap-2 shadow-lg`;
    badge.innerHTML = `
      <i class="fas fa-${levelConfig.icon}"></i>
      <span>${levelConfig.text}</span>
    `;
  }

  // è·å–ä¼šå‘˜ç­‰çº§æ–‡æœ¬
  getMemberLevelText(level) {
    const levels = {
      'vip': 'VIPä¼šå‘˜',
      'premium': 'é«˜çº§ä¼šå‘˜', 
      'basic': 'æ™®é€šä¼šå‘˜'
    };
    return levels[level] || 'æ™®é€šä¼šå‘˜';
  }

  // æ›´æ–°è¿›åº¦ç¯
  updateProgressRing(percentage) {
    const progressRing = document.querySelector('.progress-ring');
    if (progressRing) {
      progressRing.style.background = `conic-gradient(#2962FF ${percentage}%, #E5E7EB 0%)`;
    }
  }

  // æ›´æ–°å­¦ä¹ è¶‹åŠ¿
  updateStudyTrend(stats) {
    const trendElement = document.getElementById('study-time-trend');
    if (trendElement && stats) {
      const current = stats.weekStudyTime || 0;
      const lastWeek = stats.lastWeekStudyTime || 0;
      const trend = lastWeek > 0 ? ((current - lastWeek) / lastWeek * 100).toFixed(1) : (current > 0 ? 100 : 0);
      
      if (trend > 0) {
        trendElement.innerHTML = `â†‘ ${Math.abs(trend)}%`;
        trendElement.className = 'text-green-500 font-medium';
      } else if (trend < 0) {
        trendElement.innerHTML = `â†“ ${Math.abs(trend)}%`;
        trendElement.className = 'text-red-500 font-medium';
      } else {
        trendElement.textContent = 'â†’ 0%';
        trendElement.className = 'text-gray-500 font-medium';
      }
    } else {
      trendElement.innerHTML = 'â†’ 0%';
      trendElement.className = 'text-gray-500 font-medium';
    }
  }

  // æ¸²æŸ“æœ€è¿‘ç»ƒä¹ è®°å½•
  renderRecentRecords(records) {
    const container = document.getElementById('recent-records');
    if (!container) return;

    if (!records || records.length === 0) {
      container.innerHTML = '';
      return;
    }

    container.innerHTML = records.map(record => `
      <div class="bg-white border border-gray-200 rounded-xl p-4 hover:shadow-md transition-all duration-300 slide-in-right">
        <div class="flex items-center justify-between mb-3">
          <div class="flex items-center gap-3">
            <div class="w-10 h-10 bg-blue-100 rounded-lg flex items-center justify-center text-blue-600">
              <i class="fas fa-${this.getRecordIcon(record.studyType)}"></i>
            </div>
            <div>
              <div class="font-semibold text-gray-800">${record.title || 'æœªå‘½åç»ƒä¹ '}</div>
              <div class="text-gray-500 text-sm">${this.formatDate(record.date)}</div>
            </div>
          </div>
          <div class="text-right">
            <div class="text-lg font-bold ${(record.accuracy || 0) >= 80 ? 'text-green-500' : (record.accuracy || 0) >= 60 ? 'text-yellow-500' : 'text-red-500'}">
              ${record.accuracy || 0}%
            </div>
            <div class="text-xs text-gray-500">æ­£ç¡®ç‡</div>
          </div>
        </div>
        <div class="flex items-center justify-between text-sm">
          <span class="text-gray-600">${record.studyType || 'ç»¼åˆ'}ç»ƒä¹ </span>
          ${(record.wrongQuestions || 0) > 0 ? 
            `<span class="bg-red-100 text-red-600 px-2 py-1 rounded-full text-xs">${record.wrongQuestions} é“é”™é¢˜</span>` : 
            `<span class="bg-green-100 text-green-600 px-2 py-1 rounded-full text-xs">å…¨éƒ¨æ­£ç¡®</span>`
          }
        </div>
      </div>
    `).join('');
  }

  // è·å–è®°å½•å›¾æ ‡
  getRecordIcon(studyType) {
    const icons = {
      'vocabulary': 'book',
      'listening': 'headphones',
      'reading': 'book-open',
      'writing': 'pen',
      'grammar': 'language'
    };
    return icons[studyType] || 'book';
  }

  // æ ¼å¼åŒ–æ—¥æœŸ
  formatDate(dateString) {
    if (!dateString) return 'æœªçŸ¥æ—¶é—´';
    
    const date = new Date(dateString);
    if (isNaN(date.getTime())) return 'æ— æ•ˆæ—¥æœŸ';
    
    const now = new Date();
    const diffTime = Math.abs(now - date);
    const diffDays = Math.floor(diffTime / (1000 * 60 * 60 * 24));
    
    if (diffDays === 0) {
      return 'ä»Šå¤© ' + date.toLocaleTimeString('zh-CN', { hour: '2-digit', minute: '2-digit' });
    } else if (diffDays === 1) {
      return 'æ˜¨å¤© ' + date.toLocaleTimeString('zh-CN', { hour: '2-digit', minute: '2-digit' });
    } else if (diffDays < 7) {
      return `${diffDays}å¤©å‰`;
    } else {
      return date.toLocaleDateString('zh-CN', { month: '2-digit', day: '2-digit' });
    }
  }

  // åˆå§‹åŒ–å›¾è¡¨
  initCharts() {
    // æ­£ç¡®ç‡å›¾è¡¨
    const accuracyChart = document.getElementById('accuracyChart');
    if (accuracyChart) {
      this.charts.accuracy = echarts.init(accuracyChart);
    }
    
    // æŠ€èƒ½é›·è¾¾å›¾
    const skillChart = document.getElementById('skillChart');
    if (skillChart) {
      this.charts.skill = echarts.init(skillChart);
    }
    
    // çª—å£å¤§å°å˜åŒ–æ—¶é‡ç»˜å›¾è¡¨
    window.addEventListener('resize', () => {
      Object.values(this.charts).forEach(chart => {
        chart.resize();
      });
    });
  }

  // å¢å¼ºçš„å›¾è¡¨æ›´æ–°æ–¹æ³• - ä½¿ç”¨çœŸå®æŠ€èƒ½æ•°æ®
  updateCharts(weeklyAccuracy, skillLevels) {
    // æ›´æ–°æ­£ç¡®ç‡å›¾è¡¨
    if (this.charts.accuracy) {
      const hasAccuracyData = weeklyAccuracy.some(acc => acc > 0);
      
      if (hasAccuracyData) {
        this.charts.accuracy.setOption(this.getAccuracyChartOption(weeklyAccuracy));
      } else {
        this.charts.accuracy.setOption(this.getEmptyAccuracyChartOption());
      }
    }

    // æ›´æ–°æŠ€èƒ½é›·è¾¾å›¾ - ä½¿ç”¨çœŸå®æŠ€èƒ½æ•°æ®
    if (this.charts.skill) {
      const hasSkillData = skillLevels && Object.values(skillLevels).some(level => level > 0);
      
      if (hasSkillData) {
        this.charts.skill.setOption(this.getSkillChartOption(skillLevels));
      } else {
        this.charts.skill.setOption(this.getEmptySkillChartOption());
      }
    }
  }

  // ç©ºæ•°æ®æ—¶çš„æ­£ç¡®ç‡å›¾è¡¨é…ç½®
  getEmptyAccuracyChartOption() {
    return {
      animation: false,
      grid: {
        top: 10,
        right: 10,
        bottom: 20,
        left: 40,
        containLabel: true
      },
      xAxis: {
        type: 'category',
        data: ['ä¸€', 'äºŒ', 'ä¸‰', 'å››', 'äº”', 'å…­', 'æ—¥'],
        axisLine: { lineStyle: { color: '#E5E7EB' } },
        axisLabel: { color: '#6B7280' }
      },
      yAxis: {
        type: 'value',
        min: 0,
        max: 100,
        axisLine: { show: false },
        axisTick: { show: false },
        splitLine: { lineStyle: { color: '#F3F4F6' } },
        axisLabel: { color: '#6B7280', formatter: '{value}%' }
      },
      series: [{
        data: Array(7).fill(0),
        type: 'line',
        lineStyle: { color: 'transparent' },
        itemStyle: { color: 'transparent' },
        areaStyle: { color: 'transparent' }
      }],
      graphic: {
        type: 'text',
        left: 'center',
        top: 'center',
        style: {
          text: 'æš‚æ— æ•°æ®\nå¼€å§‹å­¦ä¹ åç”Ÿæˆå›¾è¡¨',
          textAlign: 'center',
          fill: '#9CA3AF',
          fontSize: 14,
          lineHeight: 20
        }
      }
    };
  }

  // ç©ºæ•°æ®æ—¶çš„æŠ€èƒ½å›¾è¡¨é…ç½®
  getEmptySkillChartOption() {
    const radarData = [
      { name: 'è¯æ±‡é‡', max: 100 },
      { name: 'å¬åŠ›ç†è§£', max: 100 },
      { name: 'é˜…è¯»é€Ÿåº¦', max: 100 },
      { name: 'è¯­æ³•æŒæ¡', max: 100 },
      { name: 'å†™ä½œèƒ½åŠ›', max: 100 }
    ];

    return {
      animation: false,
      radar: {
        indicator: radarData,
        splitArea: { areaStyle: { color: ['rgba(41, 98, 255, 0.02)', 'rgba(41, 98, 255, 0.05)'] } },
        axisLine: { lineStyle: { color: 'rgba(41, 98, 255, 0.1)' } },
        splitLine: { lineStyle: { color: 'rgba(41, 98, 255, 0.1)' } },
        name: { textStyle: { color: '#9CA3AF', fontWeight: '500' } }
      },
      series: [{
        type: 'radar',
        data: [{
          value: Array(5).fill(0),
          name: 'èƒ½åŠ›è¯„ä¼°',
          areaStyle: { color: 'rgba(41, 98, 255, 0.05)' },
          lineStyle: { color: 'rgba(41, 98, 255, 0.3)', width: 1 },
          itemStyle: { color: 'rgba(41, 98, 255, 0.3)' }
        }]
      }]
    };
  }

  // æ­£å¸¸æ•°æ®æ—¶çš„æ­£ç¡®ç‡å›¾è¡¨é…ç½®
  getAccuracyChartOption(weeklyAccuracy) {
    return {
      animation: true,
      animationDuration: 1000,
      grid: {
        top: 10,
        right: 10,
        bottom: 20,
        left: 40,
        containLabel: true
      },
      xAxis: {
        type: 'category',
        data: ['ä¸€', 'äºŒ', 'ä¸‰', 'å››', 'äº”', 'å…­', 'æ—¥'],
        axisLine: {
          lineStyle: {
            color: '#E5E7EB'
          }
        },
        axisLabel: {
          color: '#6B7280'
        }
      },
      yAxis: {
        type: 'value',
        min: 60,
        max: 100,
        axisLine: {
          show: false
        },
        axisTick: {
          show: false
        },
        splitLine: {
          lineStyle: {
            color: '#F3F4F6'
          }
        },
        axisLabel: {
          color: '#6B7280',
          formatter: '{value}%'
        }
      },
      series: [{
        data: weeklyAccuracy,
        type: 'line',
        smooth: true,
        symbolSize: 8,
        lineStyle: {
          color: '#2962FF',
          width: 3
        },
        itemStyle: {
          color: '#2962FF',
          borderColor: '#FFFFFF',
          borderWidth: 2
        },
        areaStyle: {
          color: {
            type: 'linear',
            x: 0,
            y: 0,
            x2: 0,
            y2: 1,
            colorStops: [{
              offset: 0,
              color: 'rgba(41, 98, 255, 0.3)'
            }, {
              offset: 1,
              color: 'rgba(41, 98, 255, 0.05)'
            }]
          }
        }
      }]
    };
  }

  // æ­£å¸¸æ•°æ®æ—¶çš„æŠ€èƒ½å›¾è¡¨é…ç½® - ä½¿ç”¨çœŸå®æŠ€èƒ½æ•°æ®
  getSkillChartOption(skillLevels) {
    const radarData = [
      { name: 'è¯æ±‡é‡', max: 100 },
      { name: 'å¬åŠ›ç†è§£', max: 100 },
      { name: 'é˜…è¯»é€Ÿåº¦', max: 100 },
      { name: 'è¯­æ³•æŒæ¡', max: 100 },
      { name: 'å†™ä½œèƒ½åŠ›', max: 100 }
    ];

    // ä½¿ç”¨çœŸå®çš„æŠ€èƒ½æ°´å¹³æ•°æ®
    const radarValues = [
      skillLevels['è¯æ±‡é‡'] || 0,
      skillLevels['å¬åŠ›ç†è§£'] || 0,
      skillLevels['é˜…è¯»é€Ÿåº¦'] || 0,
      skillLevels['è¯­æ³•æŒæ¡'] || 0,
      skillLevels['å†™ä½œèƒ½åŠ›'] || 0
    ];

    return {
      animation: true,
      animationDuration: 1000,
      radar: {
        indicator: radarData,
        splitArea: {
          areaStyle: {
            color: ['rgba(41, 98, 255, 0.02)', 'rgba(41, 98, 255, 0.05)', 'rgba(41, 98, 255, 0.08)', 'rgba(41, 98, 255, 0.11)']
          }
        },
        axisLine: {
          lineStyle: {
            color: 'rgba(41, 98, 255, 0.3)'
          }
        },
        splitLine: {
          lineStyle: {
            color: 'rgba(41, 98, 255, 0.3)'
          }
        },
        name: {
          textStyle: {
            color: '#6B7280',
            fontWeight: '500'
          }
        }
      },
      series: [{
        type: 'radar',
        data: [{
          value: radarValues,
          name: 'èƒ½åŠ›è¯„ä¼°',
          areaStyle: {
            color: 'rgba(41, 98, 255, 0.2)'
          },
          lineStyle: {
            color: '#2962FF',
            width: 2
          },
          itemStyle: {
            color: '#2962FF'
          },
          label: {
            show: true,
            formatter: function(params) {
              return params.value + '%';
            },
            color: '#FFFFFF',
            backgroundColor: '#2962FF',
            padding: [2, 6],
            borderRadius: 4
          }
        }]
      }]
    };
  }

  // ç§»é™¤åŠ è½½éª¨æ¶
  removeSkeletons() {
    document.querySelectorAll('.loading-skeleton').forEach(el => {
      el.classList.remove('loading-skeleton');
    });
  }

  // åˆå§‹åŒ–äº‹ä»¶ç›‘å¬
  initEventListeners() {
    // ç¼–è¾‘èµ„æ–™æŒ‰é’®
    this.addEventListener('edit-profile-btn', 'click', () => this.showEditModal());
    
    // åˆ‡æ¢è´¦å·æŒ‰é’®
    this.addEventListener('switch-account-btn', 'click', () => {
      if (confirm('ç¡®å®šè¦åˆ‡æ¢è´¦å·å—ï¼Ÿ')) {
        this.authManager.logout();
      }
    });
    
    // é€€å‡ºç™»å½•æŒ‰é’®
    this.addEventListener('logout-btn', 'click', () => {
      if (confirm('ç¡®å®šè¦é€€å‡ºç™»å½•å—ï¼Ÿ')) {
        this.authManager.logout();
      }
    });
    
    // å¤´åƒä¸Šä¼ è§¦å‘
    this.addEventListener('avatar-upload-trigger', 'click', () => this.showEditModal());
    
    // åˆ†ç±»ç­›é€‰
    document.querySelectorAll('.category-filter').forEach(btn => {
      btn.addEventListener('click', (e) => {
        this.handleCategoryFilter(e.target);
      });
    });
    
    // åˆ·æ–°è®°å½•æŒ‰é’®
    this.addEventListener('refresh-records', 'click', () => this.refreshRecentRecords());
    
    // ç¼–è¾‘æ¨¡æ€æ¡†äº‹ä»¶
    this.initEditModalEvents();
    
    // è®¤è¯çŠ¶æ€å˜åŒ–ç›‘å¬
    if (this.authManager && this.authManager.addAuthListener) {
      this.authManager.addAuthListener((isLoggedIn, user, authState) => {
        this.handleAuthStateChange(isLoggedIn, user, authState);
      });
    }
  }

  // æ·»åŠ äº‹ä»¶ç›‘å¬è¾…åŠ©æ–¹æ³•
  addEventListener(id, event, handler) {
    const element = document.getElementById(id);
    if (element) {
      element.addEventListener(event, handler.bind(this));
    }
  }

  // å¤„ç†åˆ†ç±»ç­›é€‰
  handleCategoryFilter(button) {
    // ç§»é™¤æ‰€æœ‰æ¿€æ´»çŠ¶æ€
    document.querySelectorAll('.category-filter').forEach(btn => {
      btn.classList.remove('active', 'bg-primary', 'text-white');
      btn.classList.add('border', 'border-gray-300', 'text-gray-700');
    });
    
    // æ¿€æ´»å½“å‰æŒ‰é’®
    button.classList.add('active', 'bg-primary', 'text-white');
    button.classList.remove('border', 'border-gray-300', 'text-gray-700');
    
    this.currentFilter = button.dataset.category;
    this.filterRecordsByCategory(this.currentFilter);
  }

  // æŒ‰åˆ†ç±»ç­›é€‰è®°å½•
  filterRecordsByCategory(category) {
    const records = document.querySelectorAll('#recent-records > div');
    records.forEach(record => {
      if (category === 'all') {
        record.style.display = 'block';
      } else {
        const recordType = record.querySelector('span.text-gray-600')?.textContent;
        if (recordType && recordType.includes(this.getCategoryChineseName(category))) {
          record.style.display = 'block';
        } else {
          record.style.display = 'none';
        }
      }
    });
  }

  // è·å–åˆ†ç±»ä¸­æ–‡åç§°
  getCategoryChineseName(category) {
    const names = {
      'vocabulary': 'è¯æ±‡',
      'listening': 'å¬åŠ›',
      'reading': 'é˜…è¯»',
      'writing': 'å†™ä½œ'
    };
    return names[category] || category;
  }

  // åˆ·æ–°æœ€è¿‘è®°å½• - é‡æ–°ä»æ•°æ®åº“è·å–æ•°æ®
  async refreshRecentRecords() {
    try {
      this.showLoading('åˆ·æ–°è®°å½•ä¸­...');
      
      // é‡æ–°è·å–æ‰€æœ‰æ•°æ®
      await this.loadUserDataFromAuthSystem();
      
      this.showMessage('è®°å½•å·²åˆ·æ–°', 'success');
    } catch (error) {
      console.error('åˆ·æ–°è®°å½•å¤±è´¥:', error);
      this.showMessage('åˆ·æ–°å¤±è´¥ï¼Œè¯·é‡è¯•', 'error');
    }
  }

  // å¤„ç†è®¤è¯çŠ¶æ€å˜åŒ– - ä¸å…¨å±€è®¤è¯ç³»ç»ŸåŒæ­¥
  handleAuthStateChange(isLoggedIn, user, authState) {
    console.log('ğŸ”„ ç”¨æˆ·ä¸­å¿ƒæ”¶åˆ°è®¤è¯çŠ¶æ€å˜åŒ–:', { isLoggedIn, user });
    
    if (!isLoggedIn) {
      this.showAuthRequired();
    } else {
      // é‡æ–°ä»å…¨å±€è®¤è¯ç³»ç»ŸåŠ è½½ç”¨æˆ·æ•°æ®
      this.loadUserDataFromAuthSystem();
    }
  }

  // æ˜¾ç¤ºç¼–è¾‘æ¨¡æ€æ¡†
  showEditModal() {
    if (!this.userData) return;

    const { user } = this.userData;
    document.getElementById('edit-name').value = user.name || '';
    document.getElementById('edit-phone').value = user.phone || '';
    document.getElementById('edit-avatar').value = user.avatar || '';
    
    const modal = document.getElementById('edit-profile-modal');
    modal.classList.remove('hidden');
    setTimeout(() => {
      const transformElement = modal.querySelector('.transform');
      if (transformElement) {
        transformElement.classList.remove('scale-95');
      }
    }, 10);
  }

  // åˆå§‹åŒ–ç¼–è¾‘æ¨¡æ€æ¡†äº‹ä»¶
  initEditModalEvents() {
    const modal = document.getElementById('edit-profile-modal');
    const form = document.getElementById('profile-form');
    const cancelBtn = document.getElementById('cancel-edit');
    const closeBtn = document.getElementById('close-edit-modal');

    // å–æ¶ˆç¼–è¾‘
    [cancelBtn, closeBtn].forEach(btn => {
      if (btn) {
        btn.addEventListener('click', () => this.hideEditModal());
      }
    });

    // ç‚¹å‡»æ¨¡æ€æ¡†èƒŒæ™¯å…³é—­
    modal.addEventListener('click', (e) => {
      if (e.target === modal) {
        this.hideEditModal();
      }
    });

    // æäº¤è¡¨å• - æ›´æ–°åˆ°æ•°æ®åº“
    form.addEventListener('submit', async (e) => {
      e.preventDefault();
      await this.updateProfile();
    });
  }

  // éšè—ç¼–è¾‘æ¨¡æ€æ¡†
  hideEditModal() {
    const modal = document.getElementById('edit-profile-modal');
    const transformElement = modal.querySelector('.transform');
    if (transformElement) {
      transformElement.classList.add('scale-95');
    }
    setTimeout(() => {
      modal.classList.add('hidden');
    }, 300);
  }

  // æ›´æ–°ç”¨æˆ·èµ„æ–™ - åŒæ­¥åˆ°æ•°æ®åº“
  async updateProfile() {
    const formData = {
      name: document.getElementById('edit-name').value.trim(),
      phone: document.getElementById('edit-phone').value.trim(),
      avatar: document.getElementById('edit-avatar').value.trim()
    };

    if (!formData.name) {
      this.showMessage('å§“åä¸èƒ½ä¸ºç©º', 'error');
      return;
    }

    try {
      this.showLoading('æ›´æ–°èµ„æ–™ä¸­...');

      // è°ƒç”¨APIæ›´æ–°ç”¨æˆ·èµ„æ–™åˆ°æ•°æ®åº“
      const response = await fetch('/api/user/profile', {
        method: 'PUT',
        headers: this.authManager.getAuthHeaders(),
        body: JSON.stringify(formData)
      });

      const result = await response.json();
      
      if (result.success) {
        // æ›´æ–°å…¨å±€è®¤è¯ç³»ç»Ÿçš„ç”¨æˆ·æ•°æ®
        if (this.authManager.currentUser) {
          this.authManager.currentUser = {
            ...this.authManager.currentUser,
            ...formData
          };
          // ä¿å­˜åˆ°æœ¬åœ°å­˜å‚¨
          localStorage.setItem(this.authManager.userKey, JSON.stringify(this.authManager.currentUser));
        }
        
        // è§¦å‘å…¨å±€UIæ›´æ–°
        this.authManager.notifyAuthChange();
        this.authManager.updateAllPagesUI();
        
        this.showMessage('èµ„æ–™æ›´æ–°æˆåŠŸ', 'success');
        this.hideEditModal();
        
        // é‡æ–°æ¸²æŸ“ç”¨æˆ·æ•°æ®
        this.renderUserData();
      } else {
        throw new Error(result.message);
      }
      
    } catch (error) {
      console.error('âŒ æ›´æ–°èµ„æ–™å¤±è´¥:', error);
      this.showMessage(`æ›´æ–°å¤±è´¥: ${error.message}`, 'error');
    } finally {
      this.hideLoading();
    }
  }

  // æ˜¾ç¤ºæ¶ˆæ¯ï¼ˆä¸UIç®¡ç†å™¨åŒæ­¥ï¼‰
  showMessage(message, type = 'info') {
    if (this.uiManager && this.uiManager.showMessage) {
      this.uiManager.showMessage(message, type);
    } else {
      // é™çº§æ˜¾ç¤º
      const alertClass = type === 'success' ? 'bg-green-100 text-green-800' :
                        type === 'error' ? 'bg-red-100 text-red-800' :
                        'bg-blue-100 text-blue-800';
      
      const messageEl = document.createElement('div');
      messageEl.className = `fixed top-20 right-6 px-6 py-3 rounded-lg z-50 ${alertClass} shadow-lg`;
      messageEl.textContent = message;
      
      document.body.appendChild(messageEl);
      
      setTimeout(() => {
        if (messageEl.parentNode) {
          messageEl.remove();
        }
      }, 3000);
    }
  }

  // æ˜¾ç¤ºåŠ è½½çŠ¶æ€
  showLoading(message = 'åŠ è½½ä¸­...') {
    const overlay = document.getElementById('loading-overlay');
    const messageEl = document.getElementById('loading-message');
    
    if (overlay && messageEl) {
      messageEl.textContent = message;
      overlay.classList.remove('hidden');
    }
  }

  // éšè—åŠ è½½çŠ¶æ€
  hideLoading() {
    const overlay = document.getElementById('loading-overlay');
    if (overlay) {
      overlay.classList.add('hidden');
    }
  }

  // æ˜¾ç¤ºé”™è¯¯ä¿¡æ¯
  showError(message) {
    this.showMessage(message, 'error');
    
    // åœ¨è®¤è¯çŠ¶æ€åŒºåŸŸæ˜¾ç¤ºé”™è¯¯æç¤º
    const alertElement = document.getElementById('auth-status-alert');
    if (alertElement) {
      alertElement.innerHTML = `
        <div class="bg-red-50 border border-red-200 rounded-xl p-4 flex items-center gap-3">
          <i class="fas fa-exclamation-circle text-red-500 text-xl"></i>
          <div>
            <p class="text-red-800 font-medium">åŠ è½½å¤±è´¥</p>
            <p class="text-red-600 text-sm">${message}</p>
          </div>
          <button class="ml-auto text-red-400 hover:text-red-600" onclick="this.parentElement.remove()">
            <i class="fas fa-times"></i>
          </button>
        </div>
      `;
      alertElement.classList.remove('hidden');
    }
  }
}

// åœ¨é¡µé¢åŠ è½½å®Œæˆååˆå§‹åŒ–
document.addEventListener('DOMContentLoaded', function() {
  console.log('ğŸ“„ ç”¨æˆ·ä¸­å¿ƒé¡µé¢åŠ è½½å®Œæˆ - å¢å¼ºç‰ˆï¼ˆæ•°æ®åº“é›†æˆï¼‰');
  
  // ç­‰å¾…å…¨å±€è®¤è¯ç³»ç»Ÿå°±ç»ª
  const initUserProfileManager = () => {
    if (window.unifiedAuthManager && window.unifiedAuthManager.isInitialized) {
      window.enhancedUserProfileManager = new EnhancedUserProfileManager();
    } else {
      setTimeout(initUserProfileManager, 100);
    }
  };
  
  initUserProfileManager();

  // å…¨å±€é”™è¯¯å¤„ç†
  window.addEventListener('error', function(e) {
    console.error('å…¨å±€é”™è¯¯:', e.error);
  });

  window.addEventListener('unhandledrejection', function(e) {
    console.error('æœªå¤„ç†çš„Promiseæ‹’ç»:', e.reason);
  });
});

// æ·»åŠ å…¨å±€è®¤è¯çŠ¶æ€ç›‘å¬
document.addEventListener('authSystemReady', function(e) {
  console.log('ğŸ”” ç”¨æˆ·ä¸­å¿ƒæ”¶åˆ°è®¤è¯ç³»ç»Ÿå°±ç»ªäº‹ä»¶');
  if (window.enhancedUserProfileManager) {
    window.enhancedUserProfileManager.handleAuthStateChange(
      e.detail.isLoggedIn,
      e.detail.user,
      e.detail.authState
    );
  }
});

// ç›‘å¬UIçŠ¶æ€æ›´æ–°äº‹ä»¶
document.addEventListener('uiAuthStateUpdated', function(e) {
  console.log('ğŸ”” ç”¨æˆ·ä¸­å¿ƒæ”¶åˆ°UIçŠ¶æ€æ›´æ–°äº‹ä»¶');
  if (window.enhancedUserProfileManager) {
    window.enhancedUserProfileManager.handleAuthStateChange(
      e.detail.isLoggedIn,
      e.detail.user,
      e.detail.authState
    );
  }
});

// ç›‘å¬è®¤è¯çŠ¶æ€åŒæ­¥äº‹ä»¶
document.addEventListener('authStateSynced', function(e) {
  console.log('ğŸ”” ç”¨æˆ·ä¸­å¿ƒæ”¶åˆ°è®¤è¯çŠ¶æ€åŒæ­¥äº‹ä»¶');
  if (window.enhancedUserProfileManager) {
    window.enhancedUserProfileManager.handleAuthStateChange(
      e.detail.isLoggedIn,
      e.detail.user,
      e.detail.authState
    );
  }
});
</script>
</body>
</html>