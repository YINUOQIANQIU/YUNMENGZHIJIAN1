<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>äº‘æ¢¦æ™ºé—´ - å­¦ä¹ è®¡åˆ’</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@400;500;600;700&display=swap" rel="stylesheet">
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    
    <!-- å¼•å…¥å¿…è¦çš„JSæ–‡ä»¶ -->
    <script src="äº‘æ¢¦æ™ºé—´ç»Ÿä¸€è®¤è¯.js"></script>
    <script src="äº‘æ¢¦æ™ºé—´UIç®¡ç†å™¨.js"></script>
    <script src="è®¡åˆ’ç®¡ç†å™¨.js"></script>
    
    <script>
        tailwind.config = {
            theme: {
                extend: {
                    colors: {
                        primary: '#2962FF',
                        secondary: '#1A237E',
                        success: '#4CAF50',
                        error: '#F44336'
                    },
                    borderRadius: {
                        'button': '8px'
                    },
                    fontFamily: {
                        'sans': ['Poppins', 'sans-serif']
                    }
                }
            }
        }
    </script>
    <style>
        body {
            min-height: 1024px;
            font-family: 'Poppins', sans-serif;
            background-color: #F5F7FF;
        }
        .card-hover {
            transition: all 0.3s ease;
            height: 100%;
        }
        .card-hover:hover {
            transform: translateY(-5px);
            box-shadow: 0 10px 20px rgba(41, 98, 255, 0.1);
        }
        .plan-card {
            display: flex;
            flex-direction: column;
            height: 100%;
        }
        .plan-card-content {
            flex: 1;
        }
        .template-card {
            transition: all 0.3s ease;
            border: 2px dashed #D1D5DB;
            height: 100%;
            display: flex;
            flex-direction: column;
        }
        .template-card:hover {
            border-color: #2962FF;
            transform: translateY(-2px);
        }
        .template-icon {
            width: 60px;
            height: 60px;
            border-radius: 12px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 24px;
            margin: 0 auto 16px;
        }
        .diary-entry {
            border-left: 4px solid #2962FF;
            background: #F8FAFF;
            transition: all 0.3s ease;
        }
        .diary-entry:hover {
            background: #F0F4FF;
        }
        .mood-happy { border-left-color: #10B981; }
        .mood-normal { border-left-color: #3B82F6; }
        .mood-sad { border-left-color: #EF4444; }
        .mood-tired { border-left-color: #F59E0B; }
        .mood-excited { border-left-color: #8B5CF6; }
        
        /* è¿›åº¦ç¯æ ·å¼ */
        .progress-ring {
            transform: rotate(-90deg);
        }
        
        /* ç»Ÿä¸€å¡ç‰‡é«˜åº¦ */
        .uniform-card {
            min-height: 280px;
        }
    </style>
</head>
<body>
    <!-- å¯¼èˆªæ  -->
    <nav class="flex items-center justify-between px-6 lg:px-12 h-16 bg-white/90 backdrop-blur-md fixed top-0 left-0 right-0 z-50 border-b border-blue-50">
        <div class="flex items-center gap-8 lg:gap-16">
            <a href="äº‘æ¢¦æ™ºé—´é¦–é¡µ.html" class="flex items-center gap-3">
                <span class="text-primary text-2xl font-bold tracking-tight">äº‘æ¢¦æ™ºé—´</span>
            </a>
            <div class="hidden lg:flex items-center gap-8">
                <a href="äº‘æ¢¦æ™ºé—´è®¡åˆ’.html" class="text-gray-700 hover:text-primary transition-colors font-medium active-nav">å¤‡è€ƒè§„åˆ’</a>
                <a href="äº‘æ¢¦æ™ºé—´æ•™å­¦.html" class="text-gray-700 hover:text-primary transition-colors font-medium">åœ¨çº¿æ•™å­¦</a>
                <a href="äº‘æ¢¦æ™ºé—´çœŸé¢˜è€ƒè¯•.html" class="text-gray-700 hover:text-primary transition-colors font-medium">çœŸé¢˜è€ƒè¯•</a>
                <a href="äº‘æ¢¦æ™ºé—´ç¤¾åŒº.html" class="text-gray-700 hover:text-primary transition-colors font-medium">å­¦ä¹ ç¤¾åŒº</a>
            </div>
        </div>
        
        <!-- åŠ¨æ€ç™»å½•/ç”¨æˆ·åŒºåŸŸ -->
        <div class="flex items-center gap-4 lg:gap-6" id="auth-section">
            <div id="login-btn-container">
                <a href="äº‘æ¢¦æ™ºé—´ç™»å½•.html" class="flex items-center px-4 lg:px-6 py-2 bg-blue-50 text-primary rounded-button hover:bg-blue-100 transition-colors">
                    <span class="whitespace-nowrap font-medium text-sm lg:text-base">ç™»å½•</span>
                </a>
            </div>
            <a href="äº‘æ¢¦æ™ºé—´AIèŠå¤©.html" class="flex items-center px-4 lg:px-6 py-2 bg-primary text-white rounded-button hover:bg-secondary transition-colors">
                <span class="whitespace-nowrap font-medium text-sm lg:text-base">å…è´¹è¯•ç”¨</span>
            </a>
        </div>
    </nav>

    <!-- ä¸»å†…å®¹åŒºåŸŸ -->
    <main class="pt-24 pb-16 max-w-[1440px] mx-auto px-6">
        <!-- é¡µé¢æ ‡é¢˜å’Œæ“ä½œæŒ‰é’® -->
        <div class="flex flex-col md:flex-row justify-between items-start md:items-center mb-8">
            <div>
                <h1 class="text-2xl lg:text-3xl font-bold text-secondary mb-2">æˆ‘çš„å­¦ä¹ è®¡åˆ’</h1>
                <p class="text-gray-600">åˆ¶å®šä¸ªæ€§åŒ–å­¦ä¹ è·¯å¾„ï¼Œè®°å½•æˆé•¿å†ç¨‹</p>
            </div>
            <div class="flex gap-3 mt-4 md:mt-0">
                <button onclick="planManager.generateAIPlan()" class="flex items-center gap-2 px-4 lg:px-6 py-2 bg-purple-500 text-white rounded-button hover:bg-purple-600 transition-colors">
                    <i class="fas fa-robot"></i>
                    <span>AIæ™ºèƒ½ç”Ÿæˆ</span>
                </button>
                <button onclick="planManager.showCreatePlanModal()" class="flex items-center gap-2 px-4 lg:px-6 py-2 bg-primary text-white rounded-button hover:bg-secondary transition-colors">
                    <i class="fas fa-plus"></i>
                    <span>åˆ›å»ºæ–°è®¡åˆ’</span>
                </button>
            </div>
        </div>

        <!-- è®¡åˆ’åˆ›å»ºæ–¹å¼é€‰æ‹© -->
        <div class="bg-white rounded-xl shadow-lg p-6 mb-8">
            <h2 class="text-xl lg:text-2xl font-bold text-secondary mb-6">é€‰æ‹©åˆ›å»ºæ–¹å¼</h2>
            <div class="grid grid-cols-1 md:grid-cols-3 gap-6">
                <!-- AIæ™ºèƒ½ç”Ÿæˆ -->
                <div class="text-center p-6 border-2 border-dashed border-purple-300 rounded-xl hover:border-purple-500 transition-colors cursor-pointer template-card uniform-card" 
                     onclick="planManager.generateAIPlan()">
                    <div class="template-icon bg-purple-100 text-purple-500">
                        <i class="fas fa-robot"></i>
                    </div>
                    <h3 class="font-semibold text-gray-800 mb-2">AIæ™ºèƒ½ç”Ÿæˆ</h3>
                    <p class="text-gray-600 text-sm flex-grow">åŸºäºå­¦ä¹ æ•°æ®æ™ºèƒ½åˆ†æï¼Œç”Ÿæˆä¸ªæ€§åŒ–è®¡åˆ’ï¼Œæ›´è´´åˆæ‚¨çš„å­¦ä¹ éœ€æ±‚</p>
                    <div class="mt-4 text-purple-500 text-sm font-medium">
                        æ¨èä½¿ç”¨ <i class="fas fa-arrow-right ml-1"></i>
                    </div>
                </div>
                
                <!-- ä½¿ç”¨æ¨¡æ¿ -->
                <div class="text-center p-6 border-2 border-dashed border-blue-300 rounded-xl hover:border-blue-500 transition-colors cursor-pointer template-card uniform-card" 
                     onclick="document.getElementById('templates-section').scrollIntoView({behavior: 'smooth'})">
                    <div class="template-icon bg-blue-100 text-blue-500">
                        <i class="fas fa-clone"></i>
                    </div>
                    <h3 class="font-semibold text-gray-800 mb-2">ä½¿ç”¨æ¨¡æ¿</h3>
                    <p class="text-gray-600 text-sm flex-grow">é€‰æ‹©é¢„è®¾æ¨¡æ¿ï¼Œå¿«é€Ÿåˆ›å»ºä¸“ä¸šè®¡åˆ’ï¼Œé€‚åˆç‰¹å®šå­¦ä¹ ç›®æ ‡</p>
                    <div class="mt-4 text-blue-500 text-sm font-medium">
                        å¿«é€Ÿå¼€å§‹ <i class="fas fa-arrow-right ml-1"></i>
                    </div>
                </div>
                
                <!-- å®Œå…¨è‡ªå®šä¹‰ -->
                <div class="text-center p-6 border-2 border-dashed border-green-300 rounded-xl hover:border-green-500 transition-colors cursor-pointer template-card uniform-card" 
                     onclick="planManager.showCreatePlanModal()">
                    <div class="template-icon bg-green-100 text-green-500">
                        <i class="fas fa-edit"></i>
                    </div>
                    <h3 class="font-semibold text-gray-800 mb-2">å®Œå…¨è‡ªå®šä¹‰</h3>
                    <p class="text-gray-600 text-sm flex-grow">è‡ªç”±è®¾è®¡ï¼Œåˆ›å»ºå®Œå…¨ä¸ªæ€§åŒ–çš„è®¡åˆ’ï¼Œå®Œå…¨æŒæ§å­¦ä¹ å®‰æ’</p>
                    <div class="mt-4 text-green-500 text-sm font-medium">
                        è‡ªç”±åˆ›ä½œ <i class="fas fa-arrow-right ml-1"></i>
                    </div>
                </div>
            </div>
        </div>

        <!-- å­¦ä¹ ç»Ÿè®¡å¢å¼ºç‰ˆ -->
        <div class="bg-white rounded-xl shadow-lg p-6 mb-8">
            <h2 class="text-xl lg:text-2xl font-bold text-secondary mb-6">å­¦ä¹ ç»Ÿè®¡ä¸AIåˆ†æ</h2>
            <div class="grid grid-cols-2 md:grid-cols-4 gap-4 mb-6">
                <div class="bg-blue-50 rounded-lg p-4 text-center">
                    <div class="text-2xl font-bold text-secondary mb-1" id="total-plans-count">0</div>
                    <div class="text-gray-600 text-sm">æ€»è®¡åˆ’æ•°</div>
                </div>
                <div class="bg-green-50 rounded-lg p-4 text-center">
                    <div class="text-2xl font-bold text-secondary mb-1" id="completed-plans-count">0</div>
                    <div class="text-gray-600 text-sm">å·²å®Œæˆ</div>
                </div>
                <div class="bg-purple-50 rounded-lg p-4 text-center">
                    <div class="text-2xl font-bold text-secondary mb-1" id="average-progress">0%</div>
                    <div class="text-gray-600 text-sm">å¹³å‡è¿›åº¦</div>
                </div>
                <div class="bg-orange-50 rounded-lg p-4 text-center cursor-pointer" onclick="planManager.generateAIPlan()">
                    <div class="text-2xl mb-1 text-primary">
                        <i class="fas fa-magic"></i>
                    </div>
                    <div class="text-gray-600 text-sm">AIåˆ†æ</div>
                </div>
            </div>
        </div>

        <!-- è®¡åˆ’æ¨¡æ¿åŒºåŸŸ -->
        <div id="templates-section" class="bg-white rounded-xl shadow-lg p-6 mb-8">
            <div class="flex justify-between items-center mb-6">
                <h2 class="text-xl lg:text-2xl font-bold text-secondary">ç²¾é€‰è®¡åˆ’æ¨¡æ¿</h2>
                <span class="text-gray-500 text-sm">é€‰æ‹©åˆé€‚çš„æ¨¡æ¿å¿«é€Ÿå¼€å§‹</span>
            </div>
            <div id="templates-container" class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-6">
                <!-- æ¨¡æ¿å°†é€šè¿‡JavaScriptåŠ¨æ€åŠ è½½ -->
                <div class="text-center py-8">
                    <div class="animate-spin rounded-full h-8 w-8 border-b-2 border-primary mx-auto"></div>
                    <p class="text-gray-500 mt-2">åŠ è½½æ¨¡æ¿ä¸­...</p>
                </div>
            </div>
        </div>

        <!-- è®¡åˆ’åˆ†ç±»å¯¼èˆª -->
        <div class="flex items-center gap-6 border-b border-gray-200 mb-8 overflow-x-auto">
            <button id="all-plans-tab" class="pb-3 px-1 font-medium text-sm lg:text-base border-b-2 border-primary text-primary whitespace-nowrap">å…¨éƒ¨è®¡åˆ’</button>
            <button id="ai-plans-tab" class="pb-3 px-1 font-medium text-sm lg:text-base text-gray-600 hover:text-primary transition-colors whitespace-nowrap">AIç”Ÿæˆ</button>
            <button id="custom-plans-tab" class="pb-3 px-1 font-medium text-sm lg:text-base text-gray-600 hover:text-primary transition-colors whitespace-nowrap">è‡ªå®šä¹‰</button>
            <button id="completed-plans-tab" class="pb-3 px-1 font-medium text-sm lg:text-base text-gray-600 hover:text-primary transition-colors whitespace-nowrap">å·²å®Œæˆ</button>
            <button id="active-plans-tab" class="pb-3 px-1 font-medium text-sm lg:text-base text-gray-600 hover:text-primary transition-colors whitespace-nowrap">è¿›è¡Œä¸­</button>
        </div>

        <!-- è®¡åˆ’åˆ—è¡¨ -->
        <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6 mb-12" id="plans-container">
            <!-- è®¡åˆ’å¡ç‰‡å°†é€šè¿‡JavaScriptåŠ¨æ€åŠ è½½ -->
            <div class="col-span-3 py-12 text-center">
                <div class="animate-spin rounded-full h-12 w-12 border-b-2 border-primary mx-auto mb-4"></div>
                <p class="text-gray-500">åŠ è½½è®¡åˆ’ä¸­...</p>
            </div>
        </div>

        <!-- è¿‘æœŸæ—¥è®°è®°å½• -->
        <div class="bg-white rounded-xl shadow-lg p-6 mb-12">
            <div class="flex justify-between items-center mb-6">
                <h2 class="text-xl lg:text-2xl font-bold text-secondary">è¿‘æœŸå­¦ä¹ æ—¥è®°</h2>
                <span class="text-gray-500 text-sm" id="diaries-count">æš‚æ— è®°å½•</span>
            </div>
            
            <div class="space-y-4" id="recent-diaries">
                <div class="text-center py-8">
                    <i class="fas fa-book-open text-4xl text-gray-300 mb-3"></i>
                    <p class="text-gray-500">æš‚æ— æ—¥è®°è®°å½•</p>
                    <p class="text-gray-400 text-sm mt-1">ç‚¹å‡»è®¡åˆ’å¡ç‰‡ä¸­çš„"å†™æ—¥è®°"å¼€å§‹è®°å½•</p>
                </div>
            </div>
        </div>

        <!-- AIå»ºè®®åŒºåŸŸ -->
        <div class="bg-gradient-to-r from-purple-500 to-blue-500 rounded-xl p-6 mb-12 text-white">
            <div class="flex items-start gap-4">
                <div class="w-12 h-12 bg-white/20 rounded-full flex items-center justify-center text-white text-xl">
                    <i class="fas fa-robot"></i>
                </div>
                <div class="flex-1">
                    <h3 class="text-xl font-bold text-white mb-2">AIå­¦ä¹ å»ºè®®</h3>
                    <p class="text-white/90 mb-4">åŸºäºæ‚¨çš„å­¦ä¹ æ•°æ®ï¼ŒAIä¸ºæ‚¨æä¾›ä¸ªæ€§åŒ–å»ºè®®</p>
                    <div class="bg-white/20 rounded-lg p-4">
                        <p class="text-white" id="ai-suggestion-text">æ­£åœ¨åˆ†ææ‚¨çš„å­¦ä¹ æ•°æ®...</p>
                    </div>
                    <button onclick="planManager.generateAIPlan()" class="mt-4 px-4 py-2 bg-white text-purple-600 rounded-lg hover:bg-gray-100 transition-colors font-medium">
                        <i class="fas fa-wand-magic-sparkles mr-2"></i>è·å–AIå­¦ä¹ è®¡åˆ’
                    </button>
                </div>
            </div>
        </div>
    </main>

    <script>
        // åœ¨é¡µé¢çš„ script æ ‡ç­¾ä¸­ï¼Œä¿®æ”¹åˆå§‹åŒ–éƒ¨åˆ†
        document.addEventListener('DOMContentLoaded', function() {
            // åˆå§‹åŒ–è®¡åˆ’ç®¡ç†å™¨
            if (window.planManager) {
                console.log('âœ… è®¡åˆ’ç®¡ç†å™¨åˆå§‹åŒ–å®Œæˆ');
            }
            
            // åˆå§‹åŒ–å›¾è¡¨
            initCharts();
            
            // è®¾ç½®æ ‡ç­¾é¡µåˆ‡æ¢äº‹ä»¶
            setupTabEvents();
            
            // æ›´æ–°AIå»ºè®®
            updateAISuggestion();
            
            // åŠ è½½è¿‘æœŸæ—¥è®°
            loadRecentDiaries();
        });

        // ä¿®æ”¹è®¤è¯æ£€æŸ¥ï¼Œä½¿å…¶æ›´å®½æ¾
        async function initializeWithAuth() {
            try {
                if (window.unifiedAuthManager) {
                    await unifiedAuthManager.init();
                    console.log('âœ… è®¤è¯ç³»ç»Ÿåˆå§‹åŒ–å®Œæˆ');
                }
            } catch (error) {
                console.log('ğŸ”§ è®¤è¯ç³»ç»Ÿåˆå§‹åŒ–å¤±è´¥ï¼Œä½¿ç”¨æœ¬åœ°æ¨¡å¼');
            }
        }

        // è°ƒç”¨åˆå§‹åŒ–
        initializeWithAuth();

        // è®¾ç½®æ ‡ç­¾é¡µäº‹ä»¶
        function setupTabEvents() {
            const tabs = {
                'all-plans-tab': 'all',
                'ai-plans-tab': 'ai',
                'custom-plans-tab': 'custom',
                'completed-plans-tab': 'completed',
                'active-plans-tab': 'active'
            };
            
            Object.entries(tabs).forEach(([tabId, filter]) => {
                const tab = document.getElementById(tabId);
                if (tab) {
                    tab.addEventListener('click', () => {
                        // æ›´æ–°æ´»è·ƒæ ‡ç­¾æ ·å¼
                        Object.keys(tabs).forEach(tabId => {
                            const tabElement = document.getElementById(tabId);
                            if (tabElement) {
                                tabElement.classList.remove('border-primary', 'text-primary');
                                tabElement.classList.add('text-gray-600');
                            }
                        });
                        
                        tab.classList.add('border-primary', 'text-primary');
                        tab.classList.remove('text-gray-600');
                        
                        // åŠ è½½å¯¹åº”ç­›é€‰çš„è®¡åˆ’
                        if (window.planManager) {
                            planManager.loadPlans(filter);
                        }
                    });
                }
            });
        }

        // åˆå§‹åŒ–å›¾è¡¨
        function initCharts() {
            // è®¡åˆ’åˆ†å¸ƒå›¾è¡¨
            const plansDistributionCtx = document.getElementById('plans-distribution-chart');
            if (plansDistributionCtx) {
                new Chart(plansDistributionCtx, {
                    type: 'doughnut',
                    data: {
                        labels: ['è¯æ±‡è®°å¿†', 'å¬åŠ›è®­ç»ƒ', 'é˜…è¯»ç†è§£', 'å†™ä½œæå‡', 'ç¿»è¯‘ç»ƒä¹ ', 'ç»¼åˆæå‡'],
                        datasets: [{
                            data: [25, 20, 15, 15, 10, 15],
                            backgroundColor: [
                                '#2962FF',
                                '#7E57C2',
                                '#4CAF50',
                                '#FFC107',
                                '#F44336',
                                '#FF9800'
                            ],
                            borderWidth: 0
                        }]
                    },
                    options: {
                        responsive: true,
                        maintainAspectRatio: false,
                        plugins: {
                            legend: {
                                position: 'bottom',
                                labels: {
                                    boxWidth: 12,
                                    padding: 15,
                                    font: {
                                        size: 11
                                    }
                                }
                            }
                        },
                        cutout: '60%'
                    }
                });
            }
        }

        // æ›´æ–°AIå»ºè®®
        function updateAISuggestion() {
            const suggestionText = document.getElementById('ai-suggestion-text');
            if (suggestionText) {
                const suggestions = [
                    "åŸºäºæ‚¨çš„å­¦ä¹ æ¨¡å¼ï¼Œå»ºè®®æ¯å¤©å›ºå®šæ—¶é—´å­¦ä¹ ï¼Œå»ºç«‹å­¦ä¹ ä¹ æƒ¯ã€‚",
                    "æ£€æµ‹åˆ°æ‚¨åœ¨è¯æ±‡è®°å¿†æ–¹é¢è¿›æ­¥æ˜æ˜¾ï¼Œç»§ç»­ä¿æŒï¼",
                    "å»ºè®®å¢åŠ å¬åŠ›ç»ƒä¹ æ—¶é—´ï¼Œæå‡è‹±è¯­å¬åŠ›ç†è§£èƒ½åŠ›ã€‚",
                    "æ‚¨çš„å­¦ä¹ è¿ç»­æ€§å¾ˆå¥½ï¼Œè¿ç»­å­¦ä¹ ä¼šè®©æ•ˆæœæ›´æ˜¾è‘—ã€‚",
                    "å°è¯•å°†å­¦ä¹ æ—¶é—´åˆ†æ•£åˆ°ä¸åŒæ—¶æ®µï¼Œé¿å…é•¿æ—¶é—´ç–²åŠ³å­¦ä¹ ã€‚",
                    "æ£€æµ‹åˆ°æ‚¨æœ€è¿‘å­¦ä¹ æ•ˆç‡æå‡ï¼Œç»§ç»­ä¿æŒè¿™ä¸ªçŠ¶æ€ï¼"
                ];
                
                const randomSuggestion = suggestions[Math.floor(Math.random() * suggestions.length)];
                suggestionText.textContent = randomSuggestion;
            }
        }

        // åŠ è½½è¿‘æœŸæ—¥è®°
        async function loadRecentDiaries() {
            if (window.planManager && window.planManager.plans) {
                const allDiaries = [];
                
                // æ”¶é›†æ‰€æœ‰è®¡åˆ’çš„æ—¥è®°
                for (const plan of planManager.plans) {
                    try {
                        const diaries = await planManager.getPlanDetail(plan.id);
                        if (diaries && diaries.length > 0) {
                            diaries.forEach(diary => {
                                diary.planTitle = plan.title;
                                allDiaries.push(diary);
                            });
                        }
                    } catch (error) {
                        console.error('è·å–è®¡åˆ’æ—¥è®°å¤±è´¥:', error);
                    }
                }
                
                // æŒ‰æ—¥æœŸæ’åºå¹¶æ˜¾ç¤ºæœ€è¿‘çš„5æ¡
                allDiaries.sort((a, b) => new Date(b.date) - new Date(a.date));
                const recentDiaries = allDiaries.slice(0, 5);
                
                displayRecentDiaries(recentDiaries);
            }
        }

        // æ˜¾ç¤ºè¿‘æœŸæ—¥è®°
        function displayRecentDiaries(diaries) {
            const container = document.getElementById('recent-diaries');
            const countElement = document.getElementById('diaries-count');
            
            if (!container) return;
            
            if (diaries.length === 0) {
                container.innerHTML = `
                    <div class="text-center py-8">
                        <i class="fas fa-book-open text-4xl text-gray-300 mb-3"></i>
                        <p class="text-gray-500">æš‚æ— æ—¥è®°è®°å½•</p>
                        <p class="text-gray-400 text-sm mt-1">ç‚¹å‡»è®¡åˆ’å¡ç‰‡ä¸­çš„"å†™æ—¥è®°"å¼€å§‹è®°å½•</p>
                    </div>
                `;
                if (countElement) {
                    countElement.textContent = 'æš‚æ— è®°å½•';
                }
                return;
            }
            
            if (countElement) {
                countElement.textContent = `${diaries.length} æ¡è®°å½•`;
            }
            
            container.innerHTML = diaries.map(diary => `
                <div class="diary-entry p-4 rounded-lg" onclick="planManager.showPlanDetail(${getPlanIdByTitle(diary.planTitle)})">
                    <div class="flex justify-between items-start mb-2">
                        <div class="flex-1">
                            <h4 class="font-semibold text-gray-800">${diary.planTitle}</h4>
                            <p class="text-gray-500 text-sm">${new Date(diary.date).toLocaleDateString()} ${new Date(diary.date).toLocaleTimeString()}</p>
                        </div>
                        <span class="px-2 py-1 rounded-full text-xs ${getMoodColorClass(diary.mood)}">
                            ${getMoodText(diary.mood)}
                        </span>
                    </div>
                    <p class="text-gray-700 text-sm mb-2 line-clamp-2">${diary.content}</p>
                    ${diary.achievements && diary.achievements.length > 0 ? `
                        <div class="flex items-center gap-1 text-xs text-green-600">
                            <i class="fas fa-trophy"></i>
                            <span>æˆå°±: ${diary.achievements.slice(0, 2).join('ã€')}${diary.achievements.length > 2 ? '...' : ''}</span>
                        </div>
                    ` : ''}
                </div>
            `).join('');
        }

        // è¾…åŠ©å‡½æ•°
        function getMoodText(mood) {
            const moods = {
                'happy': 'å¼€å¿ƒ',
                'normal': 'ä¸€èˆ¬',
                'sad': 'éš¾è¿‡',
                'tired': 'ç–²æƒ«',
                'excited': 'å…´å¥‹'
            };
            return moods[mood] || 'ä¸€èˆ¬';
        }

        function getMoodColorClass(mood) {
            const colors = {
                'happy': 'bg-green-100 text-green-600',
                'normal': 'bg-blue-100 text-blue-600',
                'sad': 'bg-red-100 text-red-600',
                'tired': 'bg-yellow-100 text-yellow-600',
                'excited': 'bg-purple-100 text-purple-600'
            };
            return colors[mood] || 'bg-blue-100 text-blue-600';
        }

        function getPlanIdByTitle(title) {
            if (window.planManager && window.planManager.plans) {
                const plan = planManager.plans.find(p => p.title === title);
                return plan ? plan.id : 0;
            }
            return 0;
        }

        // åˆå§‹åŒ–AIå»ºè®®
        setTimeout(updateAISuggestion, 2000);
        
        // æ¯30ç§’æ›´æ–°ä¸€æ¬¡AIå»ºè®®
        setInterval(updateAISuggestion, 30000);
    </script>
</body>
</html>